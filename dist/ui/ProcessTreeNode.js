"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _AtomInput = require("@atom-ide-community/nuclide-commons-ui/AtomInput");

var _Tree = require("@atom-ide-community/nuclide-commons-ui/Tree");

var _event = require("@atom-ide-community/nuclide-commons/event");

var _observable = require("@atom-ide-community/nuclide-commons/observable");

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _ThreadTreeNode = _interopRequireDefault(require("./ThreadTreeNode"));

var _constants = require("../constants");

var _LoadingSpinner = require("@atom-ide-community/nuclide-commons-ui/LoadingSpinner");

var _Icon = require("@atom-ide-community/nuclide-commons-ui/Icon");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class ProcessTreeNode extends React.Component {
  constructor(props) {
    super(props);
    this._disposables = void 0;
    this._filter = void 0;

    this._handleFocusChanged = () => {
      this.setState(prevState => this._getState(!(this._computeIsFocused() || !prevState.isCollapsed)));
    };

    this._handleCallStackChanged = () => {
      const {
        process
      } = this.props;
      this.setState({
        threads: process.getAllThreads()
      });
    };

    this.handleSelect = () => {
      this.setState(prevState => this._getState(!prevState.isCollapsed));
    };

    this._threadTitle = thread => {
      const stopReason = thread.stoppedDetails == null ? "" : thread.stoppedDetails.description != null ? ": " + thread.stoppedDetails.description : thread.stoppedDetails.reason != null ? ": " + thread.stoppedDetails.reason : "";
      return thread.name + (thread.stopped ? ` (Paused${stopReason})` : " (Running)");
    };

    this.state = this._getState();
    this._disposables = new _UniversalDisposable.default();
  }

  componentDidMount() {
    const {
      service
    } = this.props;
    const model = service.getModel();
    const {
      viewModel
    } = service;

    this._disposables.add(_rxjsCompatUmdMin.Observable.merge((0, _event.observableFromSubscribeFunction)(viewModel.onDidChangeDebuggerFocus.bind(viewModel))).let((0, _observable.fastDebounce)(15)).subscribe(this._handleFocusChanged), (0, _event.observableFromSubscribeFunction)(model.onDidChangeCallStack.bind(model)).let((0, _observable.fastDebounce)(15)).subscribe(this._handleCallStackChanged), (0, _event.observableFromSubscribeFunction)(service.onDidChangeProcessMode.bind(service)).subscribe(() => this.setState(prevState => this._getState(prevState.isCollapsed))));
  }

  componentWillUnmount() {
    this._disposables.dispose();
  }

  _computeIsFocused() {
    const {
      service,
      process
    } = this.props;
    const focusedProcess = service.viewModel.focusedProcess;
    return process === focusedProcess;
  }

  _getState(shouldBeCollapsed) {
    const {
      process
    } = this.props;

    const isFocused = this._computeIsFocused();

    const pendingStart = process.debuggerMode === _constants.DebuggerMode.STARTING;
    const isCollapsed = shouldBeCollapsed != null ? shouldBeCollapsed : !isFocused;
    return {
      isFocused,
      threads: process.getAllThreads(),
      isCollapsed,
      pendingStart
    };
  }

  // Returns true if thread should be kept.
  filterThread(thread) {
    const {
      filter,
      filterRegEx
    } = this.props;

    if (this.props.showPausedThreadsOnly && !thread.stopped) {
      return false;
    }

    if (filter == null) {
      return true;
    } else if (filterRegEx == null) {
      // User entered an invalid regular expression.
      // Simply check if any thread contains the user's input.
      return this.props.title.toUpperCase().includes(filter.toUpperCase());
    } else {
      return this._threadTitle(thread).match(filterRegEx) != null || thread.getCachedCallStack().some(frame => frame.name.match(filterRegEx) || frame.source.name != null && frame.source.name.match(filterRegEx));
    }
  }

  render() {
    const {
      service,
      title,
      process
    } = this.props;
    const {
      threads,
      isFocused,
      isCollapsed
    } = this.state;
    const readOnly = service.viewModel.focusedProcess != null && service.viewModel.focusedProcess.configuration.isReadOnly;

    const handleTitleClick = event => {
      if (!this._computeIsFocused()) {
        service.viewModel.setFocusedProcess(process, true);
        event.stopPropagation();
      }
    };

    const firstExtension = this.props.process.configuration.servicedFileExtensions == null ? "" : String(this.props.process.configuration.servicedFileExtensions[0]);
    const fileIcon = this.state.pendingStart ? /*#__PURE__*/React.createElement("div", {
      className: "inline-block",
      title: "Starting debugger..."
    }, /*#__PURE__*/React.createElement(_LoadingSpinner.LoadingSpinner, {
      size: _LoadingSpinner.LoadingSpinnerSizes.EXTRA_SMALL,
      className: "inline-block"
    })) : /*#__PURE__*/React.createElement("span", {
      className: `debugger-tree-file-icon ${firstExtension}-icon`,
      onClick: handleTitleClick,
      title: firstExtension.toUpperCase()
    });
    const formattedTitle = /*#__PURE__*/React.createElement("span", null, fileIcon, /*#__PURE__*/React.createElement("span", {
      onClick: handleTitleClick,
      className: isFocused ? "debugger-tree-process debugger-tree-process-thread-selected" : "debugger-tree-process",
      title: title
    }, title, readOnly ? " (READ ONLY)" : null));
    const filteredThreads = threads.filter(t => this.filterThread(t));
    const focusedThread = service.viewModel.focusedThread;
    const selectedThreadFiltered = threads.some(t => t === focusedThread) && !filteredThreads.some(t => t === focusedThread);
    const focusedThreadHiddenWarning = /*#__PURE__*/React.createElement("span", {
      className: "debugger-thread-no-match-text"
    }, /*#__PURE__*/React.createElement(_Icon.Icon, {
      icon: "nuclicon-warning"
    }), "The focused thread is hidden by your thread filter!");
    return threads.length === 0 ? /*#__PURE__*/React.createElement(_Tree.TreeItem, null, formattedTitle) : /*#__PURE__*/React.createElement(_Tree.NestedTreeItem, {
      title: formattedTitle,
      collapsed: isCollapsed,
      onSelect: this.handleSelect
    }, filteredThreads.length === 0 && threads.length > 0 ? selectedThreadFiltered ? focusedThreadHiddenWarning : /*#__PURE__*/React.createElement("span", {
      className: "debugger-thread-no-match-text"
    }, "No threads match the current filter.") : filteredThreads.map((thread, threadIndex) => /*#__PURE__*/React.createElement(_ThreadTreeNode.default, {
      key: threadIndex,
      thread: thread,
      service: service,
      threadTitle: this._threadTitle(thread)
    })).concat(selectedThreadFiltered ? focusedThreadHiddenWarning : null));
  }

}

exports.default = ProcessTreeNode;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlByb2Nlc3NUcmVlTm9kZS5qcyJdLCJuYW1lcyI6WyJQcm9jZXNzVHJlZU5vZGUiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfZGlzcG9zYWJsZXMiLCJfZmlsdGVyIiwiX2hhbmRsZUZvY3VzQ2hhbmdlZCIsInNldFN0YXRlIiwicHJldlN0YXRlIiwiX2dldFN0YXRlIiwiX2NvbXB1dGVJc0ZvY3VzZWQiLCJpc0NvbGxhcHNlZCIsIl9oYW5kbGVDYWxsU3RhY2tDaGFuZ2VkIiwicHJvY2VzcyIsInRocmVhZHMiLCJnZXRBbGxUaHJlYWRzIiwiaGFuZGxlU2VsZWN0IiwiX3RocmVhZFRpdGxlIiwidGhyZWFkIiwic3RvcFJlYXNvbiIsInN0b3BwZWREZXRhaWxzIiwiZGVzY3JpcHRpb24iLCJyZWFzb24iLCJuYW1lIiwic3RvcHBlZCIsInN0YXRlIiwiVW5pdmVyc2FsRGlzcG9zYWJsZSIsImNvbXBvbmVudERpZE1vdW50Iiwic2VydmljZSIsIm1vZGVsIiwiZ2V0TW9kZWwiLCJ2aWV3TW9kZWwiLCJhZGQiLCJPYnNlcnZhYmxlIiwibWVyZ2UiLCJvbkRpZENoYW5nZURlYnVnZ2VyRm9jdXMiLCJiaW5kIiwibGV0Iiwic3Vic2NyaWJlIiwib25EaWRDaGFuZ2VDYWxsU3RhY2siLCJvbkRpZENoYW5nZVByb2Nlc3NNb2RlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkaXNwb3NlIiwiZm9jdXNlZFByb2Nlc3MiLCJzaG91bGRCZUNvbGxhcHNlZCIsImlzRm9jdXNlZCIsInBlbmRpbmdTdGFydCIsImRlYnVnZ2VyTW9kZSIsIkRlYnVnZ2VyTW9kZSIsIlNUQVJUSU5HIiwiZmlsdGVyVGhyZWFkIiwiZmlsdGVyIiwiZmlsdGVyUmVnRXgiLCJzaG93UGF1c2VkVGhyZWFkc09ubHkiLCJ0aXRsZSIsInRvVXBwZXJDYXNlIiwiaW5jbHVkZXMiLCJtYXRjaCIsImdldENhY2hlZENhbGxTdGFjayIsInNvbWUiLCJmcmFtZSIsInNvdXJjZSIsInJlbmRlciIsInJlYWRPbmx5IiwiY29uZmlndXJhdGlvbiIsImlzUmVhZE9ubHkiLCJoYW5kbGVUaXRsZUNsaWNrIiwiZXZlbnQiLCJzZXRGb2N1c2VkUHJvY2VzcyIsInN0b3BQcm9wYWdhdGlvbiIsImZpcnN0RXh0ZW5zaW9uIiwic2VydmljZWRGaWxlRXh0ZW5zaW9ucyIsIlN0cmluZyIsImZpbGVJY29uIiwiTG9hZGluZ1NwaW5uZXJTaXplcyIsIkVYVFJBX1NNQUxMIiwiZm9ybWF0dGVkVGl0bGUiLCJmaWx0ZXJlZFRocmVhZHMiLCJ0IiwiZm9jdXNlZFRocmVhZCIsInNlbGVjdGVkVGhyZWFkRmlsdGVyZWQiLCJmb2N1c2VkVGhyZWFkSGlkZGVuV2FybmluZyIsImxlbmd0aCIsIm1hcCIsInRocmVhZEluZGV4IiwiY29uY2F0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBa0JlLE1BQU1BLGVBQU4sU0FBOEJDLEtBQUssQ0FBQ0MsU0FBcEMsQ0FBNEQ7QUFJekVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFlO0FBQ3hCLFVBQU1BLEtBQU47QUFEd0IsU0FIMUJDLFlBRzBCO0FBQUEsU0FGMUJDLE9BRTBCOztBQUFBLFNBMkIxQkMsbUJBM0IwQixHQTJCSixNQUFZO0FBQ2hDLFdBQUtDLFFBQUwsQ0FBZUMsU0FBRCxJQUFlLEtBQUtDLFNBQUwsQ0FBZSxFQUFFLEtBQUtDLGlCQUFMLE1BQTRCLENBQUNGLFNBQVMsQ0FBQ0csV0FBekMsQ0FBZixDQUE3QjtBQUNELEtBN0J5Qjs7QUFBQSxTQStCMUJDLHVCQS9CMEIsR0ErQkEsTUFBWTtBQUNwQyxZQUFNO0FBQUVDLFFBQUFBO0FBQUYsVUFBYyxLQUFLVixLQUF6QjtBQUNBLFdBQUtJLFFBQUwsQ0FBYztBQUNaTyxRQUFBQSxPQUFPLEVBQUVELE9BQU8sQ0FBQ0UsYUFBUjtBQURHLE9BQWQ7QUFHRCxLQXBD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R0FPQ0osZUFBZSxDQUNaTSxHQURILENBQ08sQ0FBQ2pFLE1BQUQsRUFBU2tFLFdBQVQsa0JBQ0gsb0JBQUMsdUJBQUQ7QUFDRSxNQUFBLEdBQUcsRUFBRUEsV0FEUDtBQUVFLE1BQUEsTUFBTSxFQUFFbEUsTUFGVjtBQUdFLE1BQUEsT0FBTyxFQUFFVSxPQUhYO0FBSUUsTUFBQSxXQUFXLEVBQUUsS0FBS1gsWUFBTCxDQUFrQkMsTUFBbEI7QUFKZixNQUZKLEVBU0dtRSxNQVRILENBU1VMLHNCQUFzQixHQUFHQywwQkFBSCxHQUFnQyxJQVRoRSxDQVJKLENBSEY7QUF3QkQ7O0FBdEx3RSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSVByb2Nlc3MsIElEZWJ1Z1NlcnZpY2UsIElUaHJlYWQgfSBmcm9tIFwiLi4vdHlwZXNcIlxuXG5pbXBvcnQgeyBBdG9tSW5wdXQgfSBmcm9tIFwiQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMtdWkvQXRvbUlucHV0XCJcbmltcG9ydCB7IFRyZWVJdGVtLCBOZXN0ZWRUcmVlSXRlbSB9IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9UcmVlXCJcbmltcG9ydCB7IG9ic2VydmFibGVGcm9tU3Vic2NyaWJlRnVuY3Rpb24gfSBmcm9tIFwiQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvZXZlbnRcIlxuaW1wb3J0IHsgZmFzdERlYm91bmNlIH0gZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL29ic2VydmFibGVcIlxuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGVcIlxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy1jb21wYXQvYnVuZGxlcy9yeGpzLWNvbXBhdC51bWQubWluLmpzXCJcbmltcG9ydCBUaHJlYWRUcmVlTm9kZSBmcm9tIFwiLi9UaHJlYWRUcmVlTm9kZVwiXG5pbXBvcnQgeyBEZWJ1Z2dlck1vZGUgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCJcbmltcG9ydCB7IExvYWRpbmdTcGlubmVyU2l6ZXMsIExvYWRpbmdTcGlubmVyIH0gZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zLXVpL0xvYWRpbmdTcGlubmVyXCJcbmltcG9ydCB7IEljb24gfSBmcm9tIFwiQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMtdWkvSWNvblwiXG5cbnR5cGUgUHJvcHMgPSB7XG4gIHByb2Nlc3M6IElQcm9jZXNzLFxuICBzZXJ2aWNlOiBJRGVidWdTZXJ2aWNlLFxuICB0aXRsZTogc3RyaW5nLFxuICBmaWx0ZXI6ID9zdHJpbmcsXG4gIGZpbHRlclJlZ0V4OiA/UmVnRXhwLFxuICBzaG93UGF1c2VkVGhyZWFkc09ubHk6IGJvb2xlYW4sXG59XG5cbnR5cGUgU3RhdGUgPSB7XG4gIGlzQ29sbGFwc2VkOiBib29sZWFuLFxuICB0aHJlYWRzOiBBcnJheTxJVGhyZWFkPixcbiAgaXNGb2N1c2VkOiBib29sZWFuLFxuICBwZW5kaW5nU3RhcnQ6IGJvb2xlYW4sXG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2Nlc3NUcmVlTm9kZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcbiAgX2Rpc3Bvc2FibGVzOiBVbml2ZXJzYWxEaXNwb3NhYmxlXG4gIF9maWx0ZXI6ID9BdG9tSW5wdXRcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogUHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcylcbiAgICB0aGlzLnN0YXRlID0gdGhpcy5fZ2V0U3RhdGUoKVxuICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbmV3IFVuaXZlcnNhbERpc3Bvc2FibGUoKVxuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKTogdm9pZCB7XG4gICAgY29uc3QgeyBzZXJ2aWNlIH0gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgbW9kZWwgPSBzZXJ2aWNlLmdldE1vZGVsKClcbiAgICBjb25zdCB7IHZpZXdNb2RlbCB9ID0gc2VydmljZVxuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmFkZChcbiAgICAgIE9ic2VydmFibGUubWVyZ2Uob2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbih2aWV3TW9kZWwub25EaWRDaGFuZ2VEZWJ1Z2dlckZvY3VzLmJpbmQodmlld01vZGVsKSkpXG4gICAgICAgIC5sZXQoZmFzdERlYm91bmNlKDE1KSlcbiAgICAgICAgLnN1YnNjcmliZSh0aGlzLl9oYW5kbGVGb2N1c0NoYW5nZWQpLFxuICAgICAgb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihtb2RlbC5vbkRpZENoYW5nZUNhbGxTdGFjay5iaW5kKG1vZGVsKSlcbiAgICAgICAgLmxldChmYXN0RGVib3VuY2UoMTUpKVxuICAgICAgICAuc3Vic2NyaWJlKHRoaXMuX2hhbmRsZUNhbGxTdGFja0NoYW5nZWQpLFxuICAgICAgb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihzZXJ2aWNlLm9uRGlkQ2hhbmdlUHJvY2Vzc01vZGUuYmluZChzZXJ2aWNlKSkuc3Vic2NyaWJlKCgpID0+XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoKHByZXZTdGF0ZSkgPT4gdGhpcy5fZ2V0U3RhdGUocHJldlN0YXRlLmlzQ29sbGFwc2VkKSlcbiAgICAgIClcbiAgICApXG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5kaXNwb3NlKClcbiAgfVxuXG4gIF9oYW5kbGVGb2N1c0NoYW5nZWQgPSAoKTogdm9pZCA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSgocHJldlN0YXRlKSA9PiB0aGlzLl9nZXRTdGF0ZSghKHRoaXMuX2NvbXB1dGVJc0ZvY3VzZWQoKSB8fCAhcHJldlN0YXRlLmlzQ29sbGFwc2VkKSkpXG4gIH1cblxuICBfaGFuZGxlQ2FsbFN0YWNrQ2hhbmdlZCA9ICgpOiB2b2lkID0+IHtcbiAgICBjb25zdCB7IHByb2Nlc3MgfSA9IHRoaXMucHJvcHNcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHRocmVhZHM6IHByb2Nlc3MuZ2V0QWxsVGhyZWFkcygpLFxuICAgIH0pXG4gIH1cblxuICBfY29tcHV0ZUlzRm9jdXNlZCgpOiBib29sZWFuIHtcbiAgICBjb25zdCB7IHNlcnZpY2UsIHByb2Nlc3MgfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBmb2N1c2VkUHJvY2VzcyA9IHNlcnZpY2Uudmlld01vZGVsLmZvY3VzZWRQcm9jZXNzXG4gICAgcmV0dXJuIHByb2Nlc3MgPT09IGZvY3VzZWRQcm9jZXNzXG4gIH1cblxuICBfZ2V0U3RhdGUoc2hvdWxkQmVDb2xsYXBzZWQ6ID9ib29sZWFuKSB7XG4gICAgY29uc3QgeyBwcm9jZXNzIH0gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgaXNGb2N1c2VkID0gdGhpcy5fY29tcHV0ZUlzRm9jdXNlZCgpXG4gICAgY29uc3QgcGVuZGluZ1N0YXJ0ID0gcHJvY2Vzcy5kZWJ1Z2dlck1vZGUgPT09IERlYnVnZ2VyTW9kZS5TVEFSVElOR1xuICAgIGNvbnN0IGlzQ29sbGFwc2VkID0gc2hvdWxkQmVDb2xsYXBzZWQgIT0gbnVsbCA/IHNob3VsZEJlQ29sbGFwc2VkIDogIWlzRm9jdXNlZFxuICAgIHJldHVybiB7XG4gICAgICBpc0ZvY3VzZWQsXG4gICAgICB0aHJlYWRzOiBwcm9jZXNzLmdldEFsbFRocmVhZHMoKSxcbiAgICAgIGlzQ29sbGFwc2VkLFxuICAgICAgcGVuZGluZ1N0YXJ0LFxuICAgIH1cbiAgfVxuXG4gIGhhbmRsZVNlbGVjdCA9ICgpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKChwcmV2U3RhdGUpID0+IHRoaXMuX2dldFN0YXRlKCFwcmV2U3RhdGUuaXNDb2xsYXBzZWQpKVxuICB9XG5cbiAgX3RocmVhZFRpdGxlID0gKHRocmVhZDogSVRocmVhZCkgPT4ge1xuICAgIGNvbnN0IHN0b3BSZWFzb24gPVxuICAgICAgdGhyZWFkLnN0b3BwZWREZXRhaWxzID09IG51bGxcbiAgICAgICAgPyBcIlwiXG4gICAgICAgIDogdGhyZWFkLnN0b3BwZWREZXRhaWxzLmRlc2NyaXB0aW9uICE9IG51bGxcbiAgICAgICAgPyBcIjogXCIgKyB0aHJlYWQuc3RvcHBlZERldGFpbHMuZGVzY3JpcHRpb25cbiAgICAgICAgOiB0aHJlYWQuc3RvcHBlZERldGFpbHMucmVhc29uICE9IG51bGxcbiAgICAgICAgPyBcIjogXCIgKyB0aHJlYWQuc3RvcHBlZERldGFpbHMucmVhc29uXG4gICAgICAgIDogXCJcIlxuICAgIHJldHVybiB0aHJlYWQubmFtZSArICh0aHJlYWQuc3RvcHBlZCA/IGAgKFBhdXNlZCR7c3RvcFJlYXNvbn0pYCA6IFwiIChSdW5uaW5nKVwiKVxuICB9XG5cbiAgLy8gUmV0dXJucyB0cnVlIGlmIHRocmVhZCBzaG91bGQgYmUga2VwdC5cbiAgZmlsdGVyVGhyZWFkKHRocmVhZDogSVRocmVhZCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHsgZmlsdGVyLCBmaWx0ZXJSZWdFeCB9ID0gdGhpcy5wcm9wc1xuICAgIGlmICh0aGlzLnByb3BzLnNob3dQYXVzZWRUaHJlYWRzT25seSAmJiAhdGhyZWFkLnN0b3BwZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9IGVsc2UgaWYgKGZpbHRlclJlZ0V4ID09IG51bGwpIHtcbiAgICAgIC8vIFVzZXIgZW50ZXJlZCBhbiBpbnZhbGlkIHJlZ3VsYXIgZXhwcmVzc2lvbi5cbiAgICAgIC8vIFNpbXBseSBjaGVjayBpZiBhbnkgdGhyZWFkIGNvbnRhaW5zIHRoZSB1c2VyJ3MgaW5wdXQuXG4gICAgICByZXR1cm4gdGhpcy5wcm9wcy50aXRsZS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlci50b1VwcGVyQ2FzZSgpKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICB0aGlzLl90aHJlYWRUaXRsZSh0aHJlYWQpLm1hdGNoKGZpbHRlclJlZ0V4KSAhPSBudWxsIHx8XG4gICAgICAgIHRocmVhZFxuICAgICAgICAgIC5nZXRDYWNoZWRDYWxsU3RhY2soKVxuICAgICAgICAgIC5zb21lKFxuICAgICAgICAgICAgKGZyYW1lKSA9PlxuICAgICAgICAgICAgICBmcmFtZS5uYW1lLm1hdGNoKGZpbHRlclJlZ0V4KSB8fCAoZnJhbWUuc291cmNlLm5hbWUgIT0gbnVsbCAmJiBmcmFtZS5zb3VyY2UubmFtZS5tYXRjaChmaWx0ZXJSZWdFeCkpXG4gICAgICAgICAgKVxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHNlcnZpY2UsIHRpdGxlLCBwcm9jZXNzIH0gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgeyB0aHJlYWRzLCBpc0ZvY3VzZWQsIGlzQ29sbGFwc2VkIH0gPSB0aGlzLnN0YXRlXG5cbiAgICBjb25zdCByZWFkT25seSA9XG4gICAgICBzZXJ2aWNlLnZpZXdNb2RlbC5mb2N1c2VkUHJvY2VzcyAhPSBudWxsICYmIHNlcnZpY2Uudmlld01vZGVsLmZvY3VzZWRQcm9jZXNzLmNvbmZpZ3VyYXRpb24uaXNSZWFkT25seVxuICAgIGNvbnN0IGhhbmRsZVRpdGxlQ2xpY2sgPSAoZXZlbnQpID0+IHtcbiAgICAgIGlmICghdGhpcy5fY29tcHV0ZUlzRm9jdXNlZCgpKSB7XG4gICAgICAgIHNlcnZpY2Uudmlld01vZGVsLnNldEZvY3VzZWRQcm9jZXNzKHByb2Nlc3MsIHRydWUpXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZmlyc3RFeHRlbnNpb24gPVxuICAgICAgdGhpcy5wcm9wcy5wcm9jZXNzLmNvbmZpZ3VyYXRpb24uc2VydmljZWRGaWxlRXh0ZW5zaW9ucyA9PSBudWxsXG4gICAgICAgID8gXCJcIlxuICAgICAgICA6IFN0cmluZyh0aGlzLnByb3BzLnByb2Nlc3MuY29uZmlndXJhdGlvbi5zZXJ2aWNlZEZpbGVFeHRlbnNpb25zWzBdKVxuICAgIGNvbnN0IGZpbGVJY29uID0gdGhpcy5zdGF0ZS5wZW5kaW5nU3RhcnQgPyAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImlubGluZS1ibG9ja1wiIHRpdGxlPVwiU3RhcnRpbmcgZGVidWdnZXIuLi5cIj5cbiAgICAgICAgPExvYWRpbmdTcGlubmVyIHNpemU9e0xvYWRpbmdTcGlubmVyU2l6ZXMuRVhUUkFfU01BTEx9IGNsYXNzTmFtZT1cImlubGluZS1ibG9ja1wiIC8+XG4gICAgICA8L2Rpdj5cbiAgICApIDogKFxuICAgICAgPHNwYW5cbiAgICAgICAgY2xhc3NOYW1lPXtgZGVidWdnZXItdHJlZS1maWxlLWljb24gJHtmaXJzdEV4dGVuc2lvbn0taWNvbmB9XG4gICAgICAgIG9uQ2xpY2s9e2hhbmRsZVRpdGxlQ2xpY2t9XG4gICAgICAgIHRpdGxlPXtmaXJzdEV4dGVuc2lvbi50b1VwcGVyQ2FzZSgpfVxuICAgICAgLz5cbiAgICApXG5cbiAgICBjb25zdCBmb3JtYXR0ZWRUaXRsZSA9IChcbiAgICAgIDxzcGFuPlxuICAgICAgICB7ZmlsZUljb259XG4gICAgICAgIDxzcGFuXG4gICAgICAgICAgb25DbGljaz17aGFuZGxlVGl0bGVDbGlja31cbiAgICAgICAgICBjbGFzc05hbWU9e1xuICAgICAgICAgICAgaXNGb2N1c2VkID8gXCJkZWJ1Z2dlci10cmVlLXByb2Nlc3MgZGVidWdnZXItdHJlZS1wcm9jZXNzLXRocmVhZC1zZWxlY3RlZFwiIDogXCJkZWJ1Z2dlci10cmVlLXByb2Nlc3NcIlxuICAgICAgICAgIH1cbiAgICAgICAgICB0aXRsZT17dGl0bGV9XG4gICAgICAgID5cbiAgICAgICAgICB7dGl0bGV9XG4gICAgICAgICAge3JlYWRPbmx5ID8gXCIgKFJFQUQgT05MWSlcIiA6IG51bGx9XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIDwvc3Bhbj5cbiAgICApXG5cbiAgICBjb25zdCBmaWx0ZXJlZFRocmVhZHMgPSB0aHJlYWRzLmZpbHRlcigodCkgPT4gdGhpcy5maWx0ZXJUaHJlYWQodCkpXG4gICAgY29uc3QgZm9jdXNlZFRocmVhZCA9IHNlcnZpY2Uudmlld01vZGVsLmZvY3VzZWRUaHJlYWRcbiAgICBjb25zdCBzZWxlY3RlZFRocmVhZEZpbHRlcmVkID1cbiAgICAgIHRocmVhZHMuc29tZSgodCkgPT4gdCA9PT0gZm9jdXNlZFRocmVhZCkgJiYgIWZpbHRlcmVkVGhyZWFkcy5zb21lKCh0KSA9PiB0ID09PSBmb2N1c2VkVGhyZWFkKVxuICAgIGNvbnN0IGZvY3VzZWRUaHJlYWRIaWRkZW5XYXJuaW5nID0gKFxuICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZGVidWdnZXItdGhyZWFkLW5vLW1hdGNoLXRleHRcIj5cbiAgICAgICAgPEljb24gaWNvbj1cIm51Y2xpY29uLXdhcm5pbmdcIiAvPlxuICAgICAgICBUaGUgZm9jdXNlZCB0aHJlYWQgaXMgaGlkZGVuIGJ5IHlvdXIgdGhyZWFkIGZpbHRlciFcbiAgICAgIDwvc3Bhbj5cbiAgICApXG4gICAgcmV0dXJuIHRocmVhZHMubGVuZ3RoID09PSAwID8gKFxuICAgICAgPFRyZWVJdGVtPntmb3JtYXR0ZWRUaXRsZX08L1RyZWVJdGVtPlxuICAgICkgOiAoXG4gICAgICA8TmVzdGVkVHJlZUl0ZW0gdGl0bGU9e2Zvcm1hdHRlZFRpdGxlfSBjb2xsYXBzZWQ9e2lzQ29sbGFwc2VkfSBvblNlbGVjdD17dGhpcy5oYW5kbGVTZWxlY3R9PlxuICAgICAgICB7ZmlsdGVyZWRUaHJlYWRzLmxlbmd0aCA9PT0gMCAmJiB0aHJlYWRzLmxlbmd0aCA+IDAgPyAoXG4gICAgICAgICAgc2VsZWN0ZWRUaHJlYWRGaWx0ZXJlZCA/IChcbiAgICAgICAgICAgIGZvY3VzZWRUaHJlYWRIaWRkZW5XYXJuaW5nXG4gICAgICAgICAgKSA6IChcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImRlYnVnZ2VyLXRocmVhZC1uby1tYXRjaC10ZXh0XCI+Tm8gdGhyZWFkcyBtYXRjaCB0aGUgY3VycmVudCBmaWx0ZXIuPC9zcGFuPlxuICAgICAgICAgIClcbiAgICAgICAgKSA6IChcbiAgICAgICAgICBmaWx0ZXJlZFRocmVhZHNcbiAgICAgICAgICAgIC5tYXAoKHRocmVhZCwgdGhyZWFkSW5kZXgpID0+IChcbiAgICAgICAgICAgICAgPFRocmVhZFRyZWVOb2RlXG4gICAgICAgICAgICAgICAga2V5PXt0aHJlYWRJbmRleH1cbiAgICAgICAgICAgICAgICB0aHJlYWQ9e3RocmVhZH1cbiAgICAgICAgICAgICAgICBzZXJ2aWNlPXtzZXJ2aWNlfVxuICAgICAgICAgICAgICAgIHRocmVhZFRpdGxlPXt0aGlzLl90aHJlYWRUaXRsZSh0aHJlYWQpfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSlcbiAgICAgICAgICAgIC5jb25jYXQoc2VsZWN0ZWRUaHJlYWRGaWx0ZXJlZCA/IGZvY3VzZWRUaHJlYWRIaWRkZW5XYXJuaW5nIDogbnVsbClcbiAgICAgICAgKX1cbiAgICAgIDwvTmVzdGVkVHJlZUl0ZW0+XG4gICAgKVxuICB9XG59XG4iXX0=