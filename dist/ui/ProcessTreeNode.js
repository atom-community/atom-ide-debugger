"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _AtomInput = require("@atom-ide-community/nuclide-commons-ui/AtomInput");

var _Tree = require("@atom-ide-community/nuclide-commons-ui/Tree");

var _event = require("@atom-ide-community/nuclide-commons/event");

var _observable = require("@atom-ide-community/nuclide-commons/observable");

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _ThreadTreeNode = _interopRequireDefault(require("./ThreadTreeNode"));

var _constants = require("../constants");

var _LoadingSpinner = require("@atom-ide-community/nuclide-commons-ui/LoadingSpinner");

var _Icon = require("@atom-ide-community/nuclide-commons-ui/Icon");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class ProcessTreeNode extends React.Component {
  constructor(props) {
    super(props);
    this._disposables = void 0;
    this._filter = void 0;

    this._handleFocusChanged = () => {
      this.setState(prevState => this._getState(!(this._computeIsFocused() || !prevState.isCollapsed)));
    };

    this._handleCallStackChanged = () => {
      const {
        process
      } = this.props;
      this.setState({
        threads: process.getAllThreads()
      });
    };

    this.handleSelect = () => {
      this.setState(prevState => this._getState(!prevState.isCollapsed));
    };

    this._threadTitle = thread => {
      const stopReason = thread.stoppedDetails == null ? "" : thread.stoppedDetails.description != null ? ": " + thread.stoppedDetails.description : thread.stoppedDetails.reason != null ? ": " + thread.stoppedDetails.reason : "";
      return thread.name + (thread.stopped ? ` (Paused${stopReason})` : " (Running)");
    };

    this.state = this._getState();
    this._disposables = new _UniversalDisposable.default();
  }

  componentDidMount() {
    const {
      service
    } = this.props;
    const model = service.getModel();
    const {
      viewModel
    } = service;

    this._disposables.add(_rxjsCompatUmdMin.Observable.merge((0, _event.observableFromSubscribeFunction)(viewModel.onDidChangeDebuggerFocus.bind(viewModel))).let((0, _observable.fastDebounce)(15)).subscribe(this._handleFocusChanged), (0, _event.observableFromSubscribeFunction)(model.onDidChangeCallStack.bind(model)).let((0, _observable.fastDebounce)(15)).subscribe(this._handleCallStackChanged), (0, _event.observableFromSubscribeFunction)(service.onDidChangeProcessMode.bind(service)).subscribe(() => this.setState(prevState => this._getState(prevState.isCollapsed))));
  }

  componentWillUnmount() {
    this._disposables.dispose();
  }

  _computeIsFocused() {
    const {
      service,
      process
    } = this.props;
    const focusedProcess = service.viewModel.focusedProcess;
    return process === focusedProcess;
  }

  _getState(shouldBeCollapsed) {
    const {
      process
    } = this.props;

    const isFocused = this._computeIsFocused();

    const pendingStart = process.debuggerMode === _constants.DebuggerMode.STARTING;
    const isCollapsed = shouldBeCollapsed != null ? shouldBeCollapsed : !isFocused;
    return {
      isFocused,
      threads: process.getAllThreads(),
      isCollapsed,
      pendingStart
    };
  }

  // Returns true if thread should be kept.
  filterThread(thread) {
    const {
      filter,
      filterRegEx
    } = this.props;

    if (this.props.showPausedThreadsOnly && !thread.stopped) {
      return false;
    }

    if (filter == null) {
      return true;
    } else if (filterRegEx == null) {
      // User entered an invalid regular expression.
      // Simply check if any thread contains the user's input.
      return this.props.title.toUpperCase().includes(filter.toUpperCase());
    } else {
      return this._threadTitle(thread).match(filterRegEx) != null || thread.getCachedCallStack().some(frame => frame.name.match(filterRegEx) || frame.source.name != null && frame.source.name.match(filterRegEx));
    }
  }

  render() {
    const {
      service,
      title,
      process
    } = this.props;
    const {
      threads,
      isFocused,
      isCollapsed
    } = this.state;
    const readOnly = service.viewModel.focusedProcess != null && service.viewModel.focusedProcess.configuration.isReadOnly;

    const handleTitleClick = event => {
      if (!this._computeIsFocused()) {
        service.viewModel.setFocusedProcess(process, true);
        event.stopPropagation();
      }
    };

    const firstExtension = this.props.process.configuration.servicedFileExtensions == null ? "" : String(this.props.process.configuration.servicedFileExtensions[0]);
    const fileIcon = this.state.pendingStart ? /*#__PURE__*/React.createElement("div", {
      className: "inline-block",
      title: "Starting debugger..."
    }, /*#__PURE__*/React.createElement(_LoadingSpinner.LoadingSpinner, {
      size: _LoadingSpinner.LoadingSpinnerSizes.EXTRA_SMALL,
      className: "inline-block"
    })) : /*#__PURE__*/React.createElement("span", {
      className: `debugger-tree-file-icon ${firstExtension}-icon`,
      onClick: handleTitleClick,
      title: firstExtension.toUpperCase()
    });
    const formattedTitle = /*#__PURE__*/React.createElement("span", null, fileIcon, /*#__PURE__*/React.createElement("span", {
      onClick: handleTitleClick,
      className: isFocused ? "debugger-tree-process debugger-tree-process-thread-selected" : "debugger-tree-process",
      title: title
    }, title, readOnly ? " (READ ONLY)" : null));
    const filteredThreads = threads.filter(t => this.filterThread(t));
    const focusedThread = service.viewModel.focusedThread;
    const selectedThreadFiltered = threads.some(t => t === focusedThread) && !filteredThreads.some(t => t === focusedThread);
    const focusedThreadHiddenWarning = /*#__PURE__*/React.createElement("span", {
      className: "debugger-thread-no-match-text"
    }, /*#__PURE__*/React.createElement(_Icon.Icon, {
      icon: "nuclicon-warning"
    }), "The focused thread is hidden by your thread filter!");
    return threads.length === 0 ? /*#__PURE__*/React.createElement(_Tree.TreeItem, null, formattedTitle) : /*#__PURE__*/React.createElement(_Tree.NestedTreeItem, {
      title: formattedTitle,
      collapsed: isCollapsed,
      onSelect: this.handleSelect
    }, filteredThreads.length === 0 && threads.length > 0 ? selectedThreadFiltered ? focusedThreadHiddenWarning : /*#__PURE__*/React.createElement("span", {
      className: "debugger-thread-no-match-text"
    }, "No threads match the current filter.") : filteredThreads.map((thread, threadIndex) => /*#__PURE__*/React.createElement(_ThreadTreeNode.default, {
      key: threadIndex,
      thread: thread,
      service: service,
      threadTitle: this._threadTitle(thread)
    })).concat(selectedThreadFiltered ? focusedThreadHiddenWarning : null));
  }

}

exports.default = ProcessTreeNode;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlByb2Nlc3NUcmVlTm9kZS5qcyJdLCJuYW1lcyI6WyJQcm9jZXNzVHJlZU5vZGUiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfZGlzcG9zYWJsZXMiLCJfZmlsdGVyIiwiX2hhbmRsZUZvY3VzQ2hhbmdlZCIsInNldFN0YXRlIiwicHJldlN0YXRlIiwiX2dldFN0YXRlIiwiX2NvbXB1dGVJc0ZvY3VzZWQiLCJpc0NvbGxhcHNlZCIsIl9oYW5kbGVDYWxsU3RhY2tDaGFuZ2VkIiwicHJvY2VzcyIsInRocmVhZHMiLCJnZXRBbGxUaHJlYWRzIiwiaGFuZGxlU2VsZWN0IiwiX3RocmVhZFRpdGxlIiwidGhyZWFkIiwic3RvcFJlYXNvbiIsInN0b3BwZWREZXRhaWxzIiwiZGVzY3JpcHRpb24iLCJyZWFzb24iLCJuYW1lIiwic3RvcHBlZCIsInN0YXRlIiwiVW5pdmVyc2FsRGlzcG9zYWJsZSIsImNvbXBvbmVudERpZE1vdW50Iiwic2VydmljZSIsIm1vZGVsIiwiZ2V0TW9kZWwiLCJ2aWV3TW9kZWwiLCJhZGQiLCJPYnNlcnZhYmxlIiwibWVyZ2UiLCJvbkRpZENoYW5nZURlYnVnZ2VyRm9jdXMiLCJiaW5kIiwibGV0Iiwic3Vic2NyaWJlIiwib25EaWRDaGFuZ2VDYWxsU3RhY2siLCJvbkRpZENoYW5nZVByb2Nlc3NNb2RlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkaXNwb3NlIiwiZm9jdXNlZFByb2Nlc3MiLCJzaG91bGRCZUNvbGxhcHNlZCIsImlzRm9jdXNlZCIsInBlbmRpbmdTdGFydCIsImRlYnVnZ2VyTW9kZSIsIkRlYnVnZ2VyTW9kZSIsIlNUQVJUSU5HIiwiZmlsdGVyVGhyZWFkIiwiZmlsdGVyIiwiZmlsdGVyUmVnRXgiLCJzaG93UGF1c2VkVGhyZWFkc09ubHkiLCJ0aXRsZSIsInRvVXBwZXJDYXNlIiwiaW5jbHVkZXMiLCJtYXRjaCIsImdldENhY2hlZENhbGxTdGFjayIsInNvbWUiLCJmcmFtZSIsInNvdXJjZSIsInJlbmRlciIsInJlYWRPbmx5IiwiY29uZmlndXJhdGlvbiIsImlzUmVhZE9ubHkiLCJoYW5kbGVUaXRsZUNsaWNrIiwiZXZlbnQiLCJzZXRGb2N1c2VkUHJvY2VzcyIsInN0b3BQcm9wYWdhdGlvbiIsImZpcnN0RXh0ZW5zaW9uIiwic2VydmljZWRGaWxlRXh0ZW5zaW9ucyIsIlN0cmluZyIsImZpbGVJY29uIiwiTG9hZGluZ1NwaW5uZXJTaXplcyIsIkVYVFJBX1NNQUxMIiwiZm9ybWF0dGVkVGl0bGUiLCJmaWx0ZXJlZFRocmVhZHMiLCJ0IiwiZm9jdXNlZFRocmVhZCIsInNlbGVjdGVkVGhyZWFkRmlsdGVyZWQiLCJmb2N1c2VkVGhyZWFkSGlkZGVuV2FybmluZyIsImxlbmd0aCIsIm1hcCIsInRocmVhZEluZGV4IiwiY29uY2F0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBa0JlLE1BQU1BLGVBQU4sU0FBOEJDLEtBQUssQ0FBQ0MsU0FBcEMsQ0FBNEQ7QUFJekVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFlO0FBQ3hCLFVBQU1BLEtBQU47QUFEd0IsU0FIMUJDLFlBRzBCO0FBQUEsU0FGMUJDLE9BRTBCOztBQUFBLFNBMkIxQkMsbUJBM0IwQixHQTJCSixNQUFZO0FBQ2hDLFdBQUtDLFFBQUwsQ0FBZUMsU0FBRCxJQUFlLEtBQUtDLFNBQUwsQ0FBZSxFQUFFLEtBQUtDLGlCQUFMLE1BQTRCLENBQUNGLFNBQVMsQ0FBQ0csV0FBekMsQ0FBZixDQUE3QjtBQUNELEtBN0J5Qjs7QUFBQSxTQStCMUJDLHVCQS9CMEIsR0ErQkEsTUFBWTtBQUNwQyxZQUFNO0FBQUVDLFFBQUFBO0FBQUYsVUFBYyxLQUFLVixLQUF6QjtBQUNBLFdBQUtJLFFBQUwsQ0FBYztBQUNaTyxRQUFBQSxPQUFPLEVBQUVELE9BQU8sQ0FBQ0UsYUFBUjtBQURHLE9BQWQ7QUFHRCxLQXBD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R0FPQ0osZUFBZSxDQUNaTSxHQURILENBQ08sQ0FBQ2pFLE1BQUQsRUFBU2tFLFdBQVQsa0JBQ0gsb0JBQUMsdUJBQUQ7QUFDRSxNQUFBLEdBQUcsRUFBRUEsV0FEUDtBQUVFLE1BQUEsTUFBTSxFQUFFbEUsTUFGVjtBQUdFLE1BQUEsT0FBTyxFQUFFVSxPQUhYO0FBSUUsTUFBQSxXQUFXLEVBQUUsS0FBS1gsWUFBTCxDQUFrQkMsTUFBbEI7QUFKZixNQUZKLEVBU0dtRSxNQVRILENBU1VMLHNCQUFzQixHQUFHQywwQkFBSCxHQUFnQyxJQVRoRSxDQVJKLENBSEY7QUF3QkQ7O0FBdEx3RSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSVByb2Nlc3MsIElEZWJ1Z1NlcnZpY2UsIElUaHJlYWQgfSBmcm9tIFwiLi4vdHlwZXNcIlxyXG5cclxuaW1wb3J0IHsgQXRvbUlucHV0IH0gZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zLXVpL0F0b21JbnB1dFwiXHJcbmltcG9ydCB7IFRyZWVJdGVtLCBOZXN0ZWRUcmVlSXRlbSB9IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9UcmVlXCJcclxuaW1wb3J0IHsgb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbiB9IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9ldmVudFwiXHJcbmltcG9ydCB7IGZhc3REZWJvdW5jZSB9IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9vYnNlcnZhYmxlXCJcclxuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGVcIlxyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIlxyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anMtY29tcGF0L2J1bmRsZXMvcnhqcy1jb21wYXQudW1kLm1pbi5qc1wiXHJcbmltcG9ydCBUaHJlYWRUcmVlTm9kZSBmcm9tIFwiLi9UaHJlYWRUcmVlTm9kZVwiXHJcbmltcG9ydCB7IERlYnVnZ2VyTW9kZSB9IGZyb20gXCIuLi9jb25zdGFudHNcIlxyXG5pbXBvcnQgeyBMb2FkaW5nU3Bpbm5lclNpemVzLCBMb2FkaW5nU3Bpbm5lciB9IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9Mb2FkaW5nU3Bpbm5lclwiXHJcbmltcG9ydCB7IEljb24gfSBmcm9tIFwiQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMtdWkvSWNvblwiXHJcblxyXG50eXBlIFByb3BzID0ge1xyXG4gIHByb2Nlc3M6IElQcm9jZXNzLFxyXG4gIHNlcnZpY2U6IElEZWJ1Z1NlcnZpY2UsXHJcbiAgdGl0bGU6IHN0cmluZyxcclxuICBmaWx0ZXI6ID9zdHJpbmcsXHJcbiAgZmlsdGVyUmVnRXg6ID9SZWdFeHAsXHJcbiAgc2hvd1BhdXNlZFRocmVhZHNPbmx5OiBib29sZWFuLFxyXG59XHJcblxyXG50eXBlIFN0YXRlID0ge1xyXG4gIGlzQ29sbGFwc2VkOiBib29sZWFuLFxyXG4gIHRocmVhZHM6IEFycmF5PElUaHJlYWQ+LFxyXG4gIGlzRm9jdXNlZDogYm9vbGVhbixcclxuICBwZW5kaW5nU3RhcnQ6IGJvb2xlYW4sXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2Nlc3NUcmVlTm9kZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcclxuICBfZGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGVcclxuICBfZmlsdGVyOiA/QXRvbUlucHV0XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpXHJcbiAgICB0aGlzLnN0YXRlID0gdGhpcy5fZ2V0U3RhdGUoKVxyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpXHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgc2VydmljZSB9ID0gdGhpcy5wcm9wc1xyXG4gICAgY29uc3QgbW9kZWwgPSBzZXJ2aWNlLmdldE1vZGVsKClcclxuICAgIGNvbnN0IHsgdmlld01vZGVsIH0gPSBzZXJ2aWNlXHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5hZGQoXHJcbiAgICAgIE9ic2VydmFibGUubWVyZ2Uob2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbih2aWV3TW9kZWwub25EaWRDaGFuZ2VEZWJ1Z2dlckZvY3VzLmJpbmQodmlld01vZGVsKSkpXHJcbiAgICAgICAgLmxldChmYXN0RGVib3VuY2UoMTUpKVxyXG4gICAgICAgIC5zdWJzY3JpYmUodGhpcy5faGFuZGxlRm9jdXNDaGFuZ2VkKSxcclxuICAgICAgb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihtb2RlbC5vbkRpZENoYW5nZUNhbGxTdGFjay5iaW5kKG1vZGVsKSlcclxuICAgICAgICAubGV0KGZhc3REZWJvdW5jZSgxNSkpXHJcbiAgICAgICAgLnN1YnNjcmliZSh0aGlzLl9oYW5kbGVDYWxsU3RhY2tDaGFuZ2VkKSxcclxuICAgICAgb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihzZXJ2aWNlLm9uRGlkQ2hhbmdlUHJvY2Vzc01vZGUuYmluZChzZXJ2aWNlKSkuc3Vic2NyaWJlKCgpID0+XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSgocHJldlN0YXRlKSA9PiB0aGlzLl9nZXRTdGF0ZShwcmV2U3RhdGUuaXNDb2xsYXBzZWQpKVxyXG4gICAgICApXHJcbiAgICApXHJcbiAgfVxyXG5cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmRpc3Bvc2UoKVxyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUZvY3VzQ2hhbmdlZCA9ICgpOiB2b2lkID0+IHtcclxuICAgIHRoaXMuc2V0U3RhdGUoKHByZXZTdGF0ZSkgPT4gdGhpcy5fZ2V0U3RhdGUoISh0aGlzLl9jb21wdXRlSXNGb2N1c2VkKCkgfHwgIXByZXZTdGF0ZS5pc0NvbGxhcHNlZCkpKVxyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUNhbGxTdGFja0NoYW5nZWQgPSAoKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCB7IHByb2Nlc3MgfSA9IHRoaXMucHJvcHNcclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICB0aHJlYWRzOiBwcm9jZXNzLmdldEFsbFRocmVhZHMoKSxcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBfY29tcHV0ZUlzRm9jdXNlZCgpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHsgc2VydmljZSwgcHJvY2VzcyB9ID0gdGhpcy5wcm9wc1xyXG4gICAgY29uc3QgZm9jdXNlZFByb2Nlc3MgPSBzZXJ2aWNlLnZpZXdNb2RlbC5mb2N1c2VkUHJvY2Vzc1xyXG4gICAgcmV0dXJuIHByb2Nlc3MgPT09IGZvY3VzZWRQcm9jZXNzXHJcbiAgfVxyXG5cclxuICBfZ2V0U3RhdGUoc2hvdWxkQmVDb2xsYXBzZWQ6ID9ib29sZWFuKSB7XHJcbiAgICBjb25zdCB7IHByb2Nlc3MgfSA9IHRoaXMucHJvcHNcclxuICAgIGNvbnN0IGlzRm9jdXNlZCA9IHRoaXMuX2NvbXB1dGVJc0ZvY3VzZWQoKVxyXG4gICAgY29uc3QgcGVuZGluZ1N0YXJ0ID0gcHJvY2Vzcy5kZWJ1Z2dlck1vZGUgPT09IERlYnVnZ2VyTW9kZS5TVEFSVElOR1xyXG4gICAgY29uc3QgaXNDb2xsYXBzZWQgPSBzaG91bGRCZUNvbGxhcHNlZCAhPSBudWxsID8gc2hvdWxkQmVDb2xsYXBzZWQgOiAhaXNGb2N1c2VkXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc0ZvY3VzZWQsXHJcbiAgICAgIHRocmVhZHM6IHByb2Nlc3MuZ2V0QWxsVGhyZWFkcygpLFxyXG4gICAgICBpc0NvbGxhcHNlZCxcclxuICAgICAgcGVuZGluZ1N0YXJ0LFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlU2VsZWN0ID0gKCkgPT4ge1xyXG4gICAgdGhpcy5zZXRTdGF0ZSgocHJldlN0YXRlKSA9PiB0aGlzLl9nZXRTdGF0ZSghcHJldlN0YXRlLmlzQ29sbGFwc2VkKSlcclxuICB9XHJcblxyXG4gIF90aHJlYWRUaXRsZSA9ICh0aHJlYWQ6IElUaHJlYWQpID0+IHtcclxuICAgIGNvbnN0IHN0b3BSZWFzb24gPVxyXG4gICAgICB0aHJlYWQuc3RvcHBlZERldGFpbHMgPT0gbnVsbFxyXG4gICAgICAgID8gXCJcIlxyXG4gICAgICAgIDogdGhyZWFkLnN0b3BwZWREZXRhaWxzLmRlc2NyaXB0aW9uICE9IG51bGxcclxuICAgICAgICA/IFwiOiBcIiArIHRocmVhZC5zdG9wcGVkRGV0YWlscy5kZXNjcmlwdGlvblxyXG4gICAgICAgIDogdGhyZWFkLnN0b3BwZWREZXRhaWxzLnJlYXNvbiAhPSBudWxsXHJcbiAgICAgICAgPyBcIjogXCIgKyB0aHJlYWQuc3RvcHBlZERldGFpbHMucmVhc29uXHJcbiAgICAgICAgOiBcIlwiXHJcbiAgICByZXR1cm4gdGhyZWFkLm5hbWUgKyAodGhyZWFkLnN0b3BwZWQgPyBgIChQYXVzZWQke3N0b3BSZWFzb259KWAgOiBcIiAoUnVubmluZylcIilcclxuICB9XHJcblxyXG4gIC8vIFJldHVybnMgdHJ1ZSBpZiB0aHJlYWQgc2hvdWxkIGJlIGtlcHQuXHJcbiAgZmlsdGVyVGhyZWFkKHRocmVhZDogSVRocmVhZCk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgeyBmaWx0ZXIsIGZpbHRlclJlZ0V4IH0gPSB0aGlzLnByb3BzXHJcbiAgICBpZiAodGhpcy5wcm9wcy5zaG93UGF1c2VkVGhyZWFkc09ubHkgJiYgIXRocmVhZC5zdG9wcGVkKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSBlbHNlIGlmIChmaWx0ZXJSZWdFeCA9PSBudWxsKSB7XHJcbiAgICAgIC8vIFVzZXIgZW50ZXJlZCBhbiBpbnZhbGlkIHJlZ3VsYXIgZXhwcmVzc2lvbi5cclxuICAgICAgLy8gU2ltcGx5IGNoZWNrIGlmIGFueSB0aHJlYWQgY29udGFpbnMgdGhlIHVzZXIncyBpbnB1dC5cclxuICAgICAgcmV0dXJuIHRoaXMucHJvcHMudGl0bGUudG9VcHBlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIudG9VcHBlckNhc2UoKSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAoXHJcbiAgICAgICAgdGhpcy5fdGhyZWFkVGl0bGUodGhyZWFkKS5tYXRjaChmaWx0ZXJSZWdFeCkgIT0gbnVsbCB8fFxyXG4gICAgICAgIHRocmVhZFxyXG4gICAgICAgICAgLmdldENhY2hlZENhbGxTdGFjaygpXHJcbiAgICAgICAgICAuc29tZShcclxuICAgICAgICAgICAgKGZyYW1lKSA9PlxyXG4gICAgICAgICAgICAgIGZyYW1lLm5hbWUubWF0Y2goZmlsdGVyUmVnRXgpIHx8IChmcmFtZS5zb3VyY2UubmFtZSAhPSBudWxsICYmIGZyYW1lLnNvdXJjZS5uYW1lLm1hdGNoKGZpbHRlclJlZ0V4KSlcclxuICAgICAgICAgIClcclxuICAgICAgKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgY29uc3QgeyBzZXJ2aWNlLCB0aXRsZSwgcHJvY2VzcyB9ID0gdGhpcy5wcm9wc1xyXG4gICAgY29uc3QgeyB0aHJlYWRzLCBpc0ZvY3VzZWQsIGlzQ29sbGFwc2VkIH0gPSB0aGlzLnN0YXRlXHJcblxyXG4gICAgY29uc3QgcmVhZE9ubHkgPVxyXG4gICAgICBzZXJ2aWNlLnZpZXdNb2RlbC5mb2N1c2VkUHJvY2VzcyAhPSBudWxsICYmIHNlcnZpY2Uudmlld01vZGVsLmZvY3VzZWRQcm9jZXNzLmNvbmZpZ3VyYXRpb24uaXNSZWFkT25seVxyXG4gICAgY29uc3QgaGFuZGxlVGl0bGVDbGljayA9IChldmVudCkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMuX2NvbXB1dGVJc0ZvY3VzZWQoKSkge1xyXG4gICAgICAgIHNlcnZpY2Uudmlld01vZGVsLnNldEZvY3VzZWRQcm9jZXNzKHByb2Nlc3MsIHRydWUpXHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpcnN0RXh0ZW5zaW9uID1cclxuICAgICAgdGhpcy5wcm9wcy5wcm9jZXNzLmNvbmZpZ3VyYXRpb24uc2VydmljZWRGaWxlRXh0ZW5zaW9ucyA9PSBudWxsXHJcbiAgICAgICAgPyBcIlwiXHJcbiAgICAgICAgOiBTdHJpbmcodGhpcy5wcm9wcy5wcm9jZXNzLmNvbmZpZ3VyYXRpb24uc2VydmljZWRGaWxlRXh0ZW5zaW9uc1swXSlcclxuICAgIGNvbnN0IGZpbGVJY29uID0gdGhpcy5zdGF0ZS5wZW5kaW5nU3RhcnQgPyAoXHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW5saW5lLWJsb2NrXCIgdGl0bGU9XCJTdGFydGluZyBkZWJ1Z2dlci4uLlwiPlxyXG4gICAgICAgIDxMb2FkaW5nU3Bpbm5lciBzaXplPXtMb2FkaW5nU3Bpbm5lclNpemVzLkVYVFJBX1NNQUxMfSBjbGFzc05hbWU9XCJpbmxpbmUtYmxvY2tcIiAvPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICkgOiAoXHJcbiAgICAgIDxzcGFuXHJcbiAgICAgICAgY2xhc3NOYW1lPXtgZGVidWdnZXItdHJlZS1maWxlLWljb24gJHtmaXJzdEV4dGVuc2lvbn0taWNvbmB9XHJcbiAgICAgICAgb25DbGljaz17aGFuZGxlVGl0bGVDbGlja31cclxuICAgICAgICB0aXRsZT17Zmlyc3RFeHRlbnNpb24udG9VcHBlckNhc2UoKX1cclxuICAgICAgLz5cclxuICAgIClcclxuXHJcbiAgICBjb25zdCBmb3JtYXR0ZWRUaXRsZSA9IChcclxuICAgICAgPHNwYW4+XHJcbiAgICAgICAge2ZpbGVJY29ufVxyXG4gICAgICAgIDxzcGFuXHJcbiAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVUaXRsZUNsaWNrfVxyXG4gICAgICAgICAgY2xhc3NOYW1lPXtcclxuICAgICAgICAgICAgaXNGb2N1c2VkID8gXCJkZWJ1Z2dlci10cmVlLXByb2Nlc3MgZGVidWdnZXItdHJlZS1wcm9jZXNzLXRocmVhZC1zZWxlY3RlZFwiIDogXCJkZWJ1Z2dlci10cmVlLXByb2Nlc3NcIlxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGl0bGU9e3RpdGxlfVxyXG4gICAgICAgID5cclxuICAgICAgICAgIHt0aXRsZX1cclxuICAgICAgICAgIHtyZWFkT25seSA/IFwiIChSRUFEIE9OTFkpXCIgOiBudWxsfVxyXG4gICAgICAgIDwvc3Bhbj5cclxuICAgICAgPC9zcGFuPlxyXG4gICAgKVxyXG5cclxuICAgIGNvbnN0IGZpbHRlcmVkVGhyZWFkcyA9IHRocmVhZHMuZmlsdGVyKCh0KSA9PiB0aGlzLmZpbHRlclRocmVhZCh0KSlcclxuICAgIGNvbnN0IGZvY3VzZWRUaHJlYWQgPSBzZXJ2aWNlLnZpZXdNb2RlbC5mb2N1c2VkVGhyZWFkXHJcbiAgICBjb25zdCBzZWxlY3RlZFRocmVhZEZpbHRlcmVkID1cclxuICAgICAgdGhyZWFkcy5zb21lKCh0KSA9PiB0ID09PSBmb2N1c2VkVGhyZWFkKSAmJiAhZmlsdGVyZWRUaHJlYWRzLnNvbWUoKHQpID0+IHQgPT09IGZvY3VzZWRUaHJlYWQpXHJcbiAgICBjb25zdCBmb2N1c2VkVGhyZWFkSGlkZGVuV2FybmluZyA9IChcclxuICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZGVidWdnZXItdGhyZWFkLW5vLW1hdGNoLXRleHRcIj5cclxuICAgICAgICA8SWNvbiBpY29uPVwibnVjbGljb24td2FybmluZ1wiIC8+XHJcbiAgICAgICAgVGhlIGZvY3VzZWQgdGhyZWFkIGlzIGhpZGRlbiBieSB5b3VyIHRocmVhZCBmaWx0ZXIhXHJcbiAgICAgIDwvc3Bhbj5cclxuICAgIClcclxuICAgIHJldHVybiB0aHJlYWRzLmxlbmd0aCA9PT0gMCA/IChcclxuICAgICAgPFRyZWVJdGVtPntmb3JtYXR0ZWRUaXRsZX08L1RyZWVJdGVtPlxyXG4gICAgKSA6IChcclxuICAgICAgPE5lc3RlZFRyZWVJdGVtIHRpdGxlPXtmb3JtYXR0ZWRUaXRsZX0gY29sbGFwc2VkPXtpc0NvbGxhcHNlZH0gb25TZWxlY3Q9e3RoaXMuaGFuZGxlU2VsZWN0fT5cclxuICAgICAgICB7ZmlsdGVyZWRUaHJlYWRzLmxlbmd0aCA9PT0gMCAmJiB0aHJlYWRzLmxlbmd0aCA+IDAgPyAoXHJcbiAgICAgICAgICBzZWxlY3RlZFRocmVhZEZpbHRlcmVkID8gKFxyXG4gICAgICAgICAgICBmb2N1c2VkVGhyZWFkSGlkZGVuV2FybmluZ1xyXG4gICAgICAgICAgKSA6IChcclxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZGVidWdnZXItdGhyZWFkLW5vLW1hdGNoLXRleHRcIj5ObyB0aHJlYWRzIG1hdGNoIHRoZSBjdXJyZW50IGZpbHRlci48L3NwYW4+XHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKSA6IChcclxuICAgICAgICAgIGZpbHRlcmVkVGhyZWFkc1xyXG4gICAgICAgICAgICAubWFwKCh0aHJlYWQsIHRocmVhZEluZGV4KSA9PiAoXHJcbiAgICAgICAgICAgICAgPFRocmVhZFRyZWVOb2RlXHJcbiAgICAgICAgICAgICAgICBrZXk9e3RocmVhZEluZGV4fVxyXG4gICAgICAgICAgICAgICAgdGhyZWFkPXt0aHJlYWR9XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlPXtzZXJ2aWNlfVxyXG4gICAgICAgICAgICAgICAgdGhyZWFkVGl0bGU9e3RoaXMuX3RocmVhZFRpdGxlKHRocmVhZCl9XHJcbiAgICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgKSlcclxuICAgICAgICAgICAgLmNvbmNhdChzZWxlY3RlZFRocmVhZEZpbHRlcmVkID8gZm9jdXNlZFRocmVhZEhpZGRlbldhcm5pbmcgOiBudWxsKVxyXG4gICAgICAgICl9XHJcbiAgICAgIDwvTmVzdGVkVHJlZUl0ZW0+XHJcbiAgICApXHJcbiAgfVxyXG59XHJcbiJdfQ==