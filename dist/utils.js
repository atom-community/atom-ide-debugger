"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.openSourceLocation = openSourceLocation;
exports.getLineForEvent = getLineForEvent;
exports.isLocalScopeName = isLocalScopeName;
exports.evaluateExpressionAsStream = evaluateExpressionAsStream;
exports.onUnexpectedError = onUnexpectedError;
exports.capitalize = capitalize;
exports.notifyOpenDebugSession = notifyOpenDebugSession;

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _logger = _interopRequireDefault(require("./logger"));

var _expected = require("@atom-ide-community/nuclide-commons/expected");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getGutterLineNumber(target) {
  const eventLine = parseInt(target.dataset.line, 10);

  if (eventLine != null && eventLine >= 0 && !isNaN(Number(eventLine))) {
    return eventLine;
  }
}

const SCREEN_ROW_ATTRIBUTE_NAME = "data-screen-row";

function getEditorLineNumber(editor, target) {
  let node = target;

  while (node != null) {
    if (node.hasAttribute(SCREEN_ROW_ATTRIBUTE_NAME)) {
      const screenRow = Number(node.getAttribute(SCREEN_ROW_ATTRIBUTE_NAME));

      try {
        return editor.bufferPositionForScreenPosition([screenRow, 0]).row;
      } catch (error) {
        return null;
      }
    }

    node = node.parentElement;
  }
}

async function getEditorOrNull(path) {
  try {
    // eslint-disable-next-line nuclide-internal/atom-apis
    return await atom.workspace.open(path, {
      searchAllPanes: true,
      pending: true
    });
  } catch (error) {
    return null;
  }
}

async function openSourceLocation(path, line) {
  const editor = await getEditorOrNull(path);

  if (editor == null) {
    // Failed to open file.
    return null;
  }

  editor.scrollToBufferPosition([line, 0]);
  editor.setCursorBufferPosition([line, 0]); // Put the focus back in the console prompt.

  atom.commands.dispatch(atom.views.getView(atom.workspace), "atom-ide-console:focus-console-prompt");
  return editor;
}

function firstNonNull(...args) {
  return (0, _nullthrows.default)(args.find(arg => arg != null));
}

function getLineForEvent(editor, event) {
  const cursorLine = editor.getLastCursor().getBufferRow();
  const target = event ? event.target : null;

  if (target == null) {
    return cursorLine;
  } // toggleLine is the line the user clicked in the gutter next to, as opposed
  // to the line the editor's cursor happens to be in. If this command was invoked
  // from the menu, then the cursor position is the target line.


  return firstNonNull(getGutterLineNumber(target), getEditorLineNumber(editor, target), // fall back to the line the cursor is on.
  cursorLine);
}

function isLocalScopeName(scopeName) {
  return ["Local", "Locals"].indexOf(scopeName) !== -1;
}

function evaluateExpressionAsStream(expression, focusedProcess, focusedStackFrame, context) {
  return _rxjsCompatUmdMin.Observable.fromPromise(expression.evaluate(focusedProcess, focusedStackFrame, context)).catch(error => _rxjsCompatUmdMin.Observable.of(_expected.Expect.error(error))).map(() => _expected.Expect.value(expression)).startWith(_expected.Expect.pending());
}

function onUnexpectedError(error) {
  const errorMessage = error.stack || error.message || String(error);

  _logger.default.error("Unexpected error", error);

  atom.notifications.addError("Atom debugger ran into an unexpected error - please file a bug!", {
    detail: errorMessage
  });
}

function capitalize(str) {
  return str[0].toUpperCase() + str.slice(1);
}

function notifyOpenDebugSession() {
  atom.notifications.addInfo("Received a debug request, but there's an open debug session already!", {
    detail: "Please terminate your existing debug session"
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbImdldEd1dHRlckxpbmVOdW1iZXIiLCJ0YXJnZXQiLCJldmVudExpbmUiLCJwYXJzZUludCIsImRhdGFzZXQiLCJsaW5lIiwiaXNOYU4iLCJOdW1iZXIiLCJTQ1JFRU5fUk9XX0FUVFJJQlVURV9OQU1FIiwiZ2V0RWRpdG9yTGluZU51bWJlciIsImVkaXRvciIsIm5vZGUiLCJoYXNBdHRyaWJ1dGUiLCJzY3JlZW5Sb3ciLCJnZXRBdHRyaWJ1dGUiLCJidWZmZXJQb3NpdGlvbkZvclNjcmVlblBvc2l0aW9uIiwicm93IiwiZXJyb3IiLCJwYXJlbnRFbGVtZW50IiwiZ2V0RWRpdG9yT3JOdWxsIiwicGF0aCIsImF0b20iLCJ3b3Jrc3BhY2UiLCJvcGVuIiwic2VhcmNoQWxsUGFuZXMiLCJwZW5kaW5nIiwib3BlblNvdXJjZUxvY2F0aW9uIiwic2Nyb2xsVG9CdWZmZXJQb3NpdGlvbiIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwiY29tbWFuZHMiLCJkaXNwYXRjaCIsInZpZXdzIiwiZ2V0VmlldyIsImZpcnN0Tm9uTnVsbCIsImFyZ3MiLCJmaW5kIiwiYXJnIiwiZ2V0TGluZUZvckV2ZW50IiwiZXZlbnQiLCJjdXJzb3JMaW5lIiwiZ2V0TGFzdEN1cnNvciIsImdldEJ1ZmZlclJvdyIsImlzTG9jYWxTY29wZU5hbWUiLCJzY29wZU5hbWUiLCJpbmRleE9mIiwiZXZhbHVhdGVFeHByZXNzaW9uQXNTdHJlYW0iLCJleHByZXNzaW9uIiwiZm9jdXNlZFByb2Nlc3MiLCJmb2N1c2VkU3RhY2tGcmFtZSIsImNvbnRleHQiLCJPYnNlcnZhYmxlIiwiZnJvbVByb21pc2UiLCJldmFsdWF0ZSIsImNhdGNoIiwib2YiLCJFeHBlY3QiLCJtYXAiLCJ2YWx1ZSIsInN0YXJ0V2l0aCIsIm9uVW5leHBlY3RlZEVycm9yIiwiZXJyb3JNZXNzYWdlIiwic3RhY2siLCJtZXNzYWdlIiwiU3RyaW5nIiwibG9nZ2VyIiwibm90aWZpY2F0aW9ucyIsImFkZEVycm9yIiwiZGV0YWlsIiwiY2FwaXRhbGl6ZSIsInN0ciIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJub3RpZnlPcGVuRGVidWdTZXNzaW9uIiwiYWRkSW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsU0FBU0EsbUJBQVQsQ0FBNkJDLE1BQTdCLEVBQTJEO0FBQ3pELFFBQU1DLFNBQVMsR0FBR0MsUUFBUSxDQUFDRixNQUFNLENBQUNHLE9BQVAsQ0FBZUMsSUFBaEIsRUFBc0IsRUFBdEIsQ0FBMUI7O0FBQ0EsTUFBSUgsU0FBUyxJQUFJLElBQWIsSUFBcUJBLFNBQVMsSUFBSSxDQUFsQyxJQUF1QyxDQUFDSSxLQUFLLENBQUNDLE1BQU0sQ0FBQ0wsU0FBRCxDQUFQLENBQWpELEVBQXNFO0FBQ3BFLFdBQU9BLFNBQVA7QUFDRDtBQUNGOztBQUVELE1BQU1NLHlCQUF5QixHQUFHLGlCQUFsQzs7QUFFQSxTQUFTQyxtQkFBVCxDQUE2QkMsTUFBN0IsRUFBc0RULE1BQXRELEVBQW9GO0FBQ2xGLE1BQUlVLElBQUksR0FBR1YsTUFBWDs7QUFDQSxTQUFPVSxJQUFJLElBQUksSUFBZixFQUFxQjtBQUNuQixRQUFJQSxJQUFJLENBQUNDLFlBQUwsQ0FBa0JKLHlCQUFsQixDQUFKLEVBQWtEO0FBQ2hELFlBQU1LLFNBQVMsR0FBR04sTUFBTSxDQUFDSSxJQUFJLENBQUNHLFlBQUwsQ0FBa0JOLHlCQUFsQixDQUFELENBQXhCOztBQUNBLFVBQUk7QUFDRixlQUFPRSxNQUFNLENBQUNLLCtCQUFQLENBQXVDLENBQUNGLFNBQUQsRUFBWSxDQUFaLENBQXZDLEVBQXVERyxHQUE5RDtBQUNELE9BRkQsQ0FFRSxPQUFPQyxLQUFQLEVBQWM7QUFDZCxlQUFPLElBQVA7QUFDRDtBQUNGOztBQUNETixJQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ08sYUFBWjtBQUNEO0FBQ0Y7O0FBRUQsZUFBZUMsZUFBZixDQUErQkMsSUFBL0IsRUFBd0U7QUFD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QzRDLGFBQUwsQ0FBbUJDLFFBQW5CLENBQTRCLGlFQUE1QixFQUErRjtBQUM3RkMsSUFBQUEsTUFBTSxFQUFFUDtBQURxRixHQUEvRjtBQUdEOztBQUVNLFNBQVNRLFVBQVQsQ0FBb0JDLEdBQXBCLEVBQXlDO0FBQzlDLFNBQU9BLEdBQUcsQ0FBQyxDQUFELENBQUgsQ0FBT0MsV0FBUCxLQUF1QkQsR0FBRyxDQUFDRSxLQUFKLENBQVUsQ0FBVixDQUE5QjtBQUNEOztBQUVNLFNBQVNDLHNCQUFULEdBQXdDO0FBQzdDbkQsRUFBQUEsSUFBSSxDQUFDNEMsYUFBTCxDQUFtQlEsT0FBbkIsQ0FBMkIsc0VBQTNCLEVBQW1HO0FBQ2pHTixJQUFBQSxNQUFNLEVBQUU7QUFEeUYsR0FBbkc7QUFHRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSUV4cHJlc3Npb24sIElFdmFsdWF0YWJsZUV4cHJlc3Npb24sIElQcm9jZXNzLCBJU3RhY2tGcmFtZSwgQ29udGV4dFR5cGUgfSBmcm9tIFwiLi90eXBlc1wiXG5pbXBvcnQgdHlwZSB7IEV4cGVjdGVkIH0gZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2V4cGVjdGVkXCJcblxuaW1wb3J0IG51bGx0aHJvd3MgZnJvbSBcIm51bGx0aHJvd3NcIlxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzLWNvbXBhdC9idW5kbGVzL3J4anMtY29tcGF0LnVtZC5taW4uanNcIlxuaW1wb3J0IGxvZ2dlciBmcm9tIFwiLi9sb2dnZXJcIlxuaW1wb3J0IHsgRXhwZWN0IH0gZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2V4cGVjdGVkXCJcblxuZnVuY3Rpb24gZ2V0R3V0dGVyTGluZU51bWJlcih0YXJnZXQ6IEhUTUxFbGVtZW50KTogP251bWJlciB7XG4gIGNvbnN0IGV2ZW50TGluZSA9IHBhcnNlSW50KHRhcmdldC5kYXRhc2V0LmxpbmUsIDEwKVxuICBpZiAoZXZlbnRMaW5lICE9IG51bGwgJiYgZXZlbnRMaW5lID49IDAgJiYgIWlzTmFOKE51bWJlcihldmVudExpbmUpKSkge1xuICAgIHJldHVybiBldmVudExpbmVcbiAgfVxufVxuXG5jb25zdCBTQ1JFRU5fUk9XX0FUVFJJQlVURV9OQU1FID0gXCJkYXRhLXNjcmVlbi1yb3dcIlxuXG5mdW5jdGlvbiBnZXRFZGl0b3JMaW5lTnVtYmVyKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCB0YXJnZXQ6IEhUTUxFbGVtZW50KTogP251bWJlciB7XG4gIGxldCBub2RlID0gdGFyZ2V0XG4gIHdoaWxlIChub2RlICE9IG51bGwpIHtcbiAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGUoU0NSRUVOX1JPV19BVFRSSUJVVEVfTkFNRSkpIHtcbiAgICAgIGNvbnN0IHNjcmVlblJvdyA9IE51bWJlcihub2RlLmdldEF0dHJpYnV0ZShTQ1JFRU5fUk9XX0FUVFJJQlVURV9OQU1FKSlcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBlZGl0b3IuYnVmZmVyUG9zaXRpb25Gb3JTY3JlZW5Qb3NpdGlvbihbc2NyZWVuUm93LCAwXSkucm93XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuICAgIH1cbiAgICBub2RlID0gbm9kZS5wYXJlbnRFbGVtZW50XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RWRpdG9yT3JOdWxsKHBhdGg6IHN0cmluZyk6IFByb21pc2U8P2F0b20kVGV4dEVkaXRvcj4ge1xuICB0cnkge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBudWNsaWRlLWludGVybmFsL2F0b20tYXBpc1xuICAgIHJldHVybiBhd2FpdCBhdG9tLndvcmtzcGFjZS5vcGVuKHBhdGgsIHtcbiAgICAgIHNlYXJjaEFsbFBhbmVzOiB0cnVlLFxuICAgICAgcGVuZGluZzogdHJ1ZSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG9wZW5Tb3VyY2VMb2NhdGlvbihwYXRoOiBzdHJpbmcsIGxpbmU6IG51bWJlcik6IFByb21pc2U8P2F0b20kVGV4dEVkaXRvcj4ge1xuICBjb25zdCBlZGl0b3IgPSBhd2FpdCBnZXRFZGl0b3JPck51bGwocGF0aClcbiAgaWYgKGVkaXRvciA9PSBudWxsKSB7XG4gICAgLy8gRmFpbGVkIHRvIG9wZW4gZmlsZS5cbiAgICByZXR1cm4gbnVsbFxuICB9XG4gIGVkaXRvci5zY3JvbGxUb0J1ZmZlclBvc2l0aW9uKFtsaW5lLCAwXSlcbiAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFtsaW5lLCAwXSlcblxuICAvLyBQdXQgdGhlIGZvY3VzIGJhY2sgaW4gdGhlIGNvbnNvbGUgcHJvbXB0LlxuICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGF0b20udmlld3MuZ2V0VmlldyhhdG9tLndvcmtzcGFjZSksIFwiYXRvbS1pZGUtY29uc29sZTpmb2N1cy1jb25zb2xlLXByb21wdFwiKVxuXG4gIHJldHVybiBlZGl0b3Jcbn1cblxuZnVuY3Rpb24gZmlyc3ROb25OdWxsKC4uLmFyZ3MpIHtcbiAgcmV0dXJuIG51bGx0aHJvd3MoYXJncy5maW5kKChhcmcpID0+IGFyZyAhPSBudWxsKSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExpbmVGb3JFdmVudChlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgZXZlbnQ6IGFueSk6IG51bWJlciB7XG4gIGNvbnN0IGN1cnNvckxpbmUgPSBlZGl0b3IuZ2V0TGFzdEN1cnNvcigpLmdldEJ1ZmZlclJvdygpXG4gIGNvbnN0IHRhcmdldCA9IGV2ZW50ID8gKGV2ZW50LnRhcmdldDogSFRNTEVsZW1lbnQpIDogbnVsbFxuICBpZiAodGFyZ2V0ID09IG51bGwpIHtcbiAgICByZXR1cm4gY3Vyc29yTGluZVxuICB9XG4gIC8vIHRvZ2dsZUxpbmUgaXMgdGhlIGxpbmUgdGhlIHVzZXIgY2xpY2tlZCBpbiB0aGUgZ3V0dGVyIG5leHQgdG8sIGFzIG9wcG9zZWRcbiAgLy8gdG8gdGhlIGxpbmUgdGhlIGVkaXRvcidzIGN1cnNvciBoYXBwZW5zIHRvIGJlIGluLiBJZiB0aGlzIGNvbW1hbmQgd2FzIGludm9rZWRcbiAgLy8gZnJvbSB0aGUgbWVudSwgdGhlbiB0aGUgY3Vyc29yIHBvc2l0aW9uIGlzIHRoZSB0YXJnZXQgbGluZS5cbiAgcmV0dXJuIGZpcnN0Tm9uTnVsbChcbiAgICBnZXRHdXR0ZXJMaW5lTnVtYmVyKHRhcmdldCksXG4gICAgZ2V0RWRpdG9yTGluZU51bWJlcihlZGl0b3IsIHRhcmdldCksXG4gICAgLy8gZmFsbCBiYWNrIHRvIHRoZSBsaW5lIHRoZSBjdXJzb3IgaXMgb24uXG4gICAgY3Vyc29yTGluZVxuICApXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0xvY2FsU2NvcGVOYW1lKHNjb3BlTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBbXCJMb2NhbFwiLCBcIkxvY2Fsc1wiXS5pbmRleE9mKHNjb3BlTmFtZSkgIT09IC0xXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBldmFsdWF0ZUV4cHJlc3Npb25Bc1N0cmVhbShcbiAgZXhwcmVzc2lvbjogSUV2YWx1YXRhYmxlRXhwcmVzc2lvbixcbiAgZm9jdXNlZFByb2Nlc3M6IElQcm9jZXNzLFxuICBmb2N1c2VkU3RhY2tGcmFtZTogP0lTdGFja0ZyYW1lLFxuICBjb250ZXh0OiBDb250ZXh0VHlwZVxuKTogT2JzZXJ2YWJsZTxFeHBlY3RlZDxJRXhwcmVzc2lvbj4+IHtcbiAgcmV0dXJuIE9ic2VydmFibGUuZnJvbVByb21pc2UoZXhwcmVzc2lvbi5ldmFsdWF0ZShmb2N1c2VkUHJvY2VzcywgZm9jdXNlZFN0YWNrRnJhbWUsIGNvbnRleHQpKVxuICAgIC5jYXRjaCgoZXJyb3IpID0+IE9ic2VydmFibGUub2YoRXhwZWN0LmVycm9yKGVycm9yKSkpXG4gICAgLm1hcCgoKSA9PiBFeHBlY3QudmFsdWUoZXhwcmVzc2lvbikpXG4gICAgLnN0YXJ0V2l0aChFeHBlY3QucGVuZGluZygpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gb25VbmV4cGVjdGVkRXJyb3IoZXJyb3I6IGFueSkge1xuICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvci5zdGFjayB8fCBlcnJvci5tZXNzYWdlIHx8IFN0cmluZyhlcnJvcilcbiAgbG9nZ2VyLmVycm9yKFwiVW5leHBlY3RlZCBlcnJvclwiLCBlcnJvcilcbiAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFwiQXRvbSBkZWJ1Z2dlciByYW4gaW50byBhbiB1bmV4cGVjdGVkIGVycm9yIC0gcGxlYXNlIGZpbGUgYSBidWchXCIsIHtcbiAgICBkZXRhaWw6IGVycm9yTWVzc2FnZSxcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gc3RyWzBdLnRvVXBwZXJDYXNlKCkgKyBzdHIuc2xpY2UoMSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vdGlmeU9wZW5EZWJ1Z1Nlc3Npb24oKTogdm9pZCB7XG4gIGF0b20ubm90aWZpY2F0aW9ucy5hZGRJbmZvKFwiUmVjZWl2ZWQgYSBkZWJ1ZyByZXF1ZXN0LCBidXQgdGhlcmUncyBhbiBvcGVuIGRlYnVnIHNlc3Npb24gYWxyZWFkeSFcIiwge1xuICAgIGRldGFpbDogXCJQbGVhc2UgdGVybWluYXRlIHlvdXIgZXhpc3RpbmcgZGVidWcgc2Vzc2lvblwiLFxuICB9KVxufVxuIl19