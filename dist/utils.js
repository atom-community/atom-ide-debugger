"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.openSourceLocation = openSourceLocation;
exports.getLineForEvent = getLineForEvent;
exports.isLocalScopeName = isLocalScopeName;
exports.evaluateExpressionAsStream = evaluateExpressionAsStream;
exports.onUnexpectedError = onUnexpectedError;
exports.capitalize = capitalize;
exports.notifyOpenDebugSession = notifyOpenDebugSession;

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _logger = _interopRequireDefault(require("./logger"));

var _expected = require("@atom-ide-community/nuclide-commons/expected");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getGutterLineNumber(target) {
  const eventLine = parseInt(target.dataset.line, 10);

  if (eventLine != null && eventLine >= 0 && !isNaN(Number(eventLine))) {
    return eventLine;
  }
}

const SCREEN_ROW_ATTRIBUTE_NAME = "data-screen-row";

function getEditorLineNumber(editor, target) {
  let node = target;

  while (node != null) {
    if (node.hasAttribute(SCREEN_ROW_ATTRIBUTE_NAME)) {
      const screenRow = Number(node.getAttribute(SCREEN_ROW_ATTRIBUTE_NAME));

      try {
        return editor.bufferPositionForScreenPosition([screenRow, 0]).row;
      } catch (error) {
        return null;
      }
    }

    node = node.parentElement;
  }
}

async function getEditorOrNull(path) {
  try {
    // eslint-disable-next-line nuclide-internal/atom-apis
    return await atom.workspace.open(path, {
      searchAllPanes: true,
      pending: true
    });
  } catch (error) {
    return null;
  }
}

async function openSourceLocation(path, line) {
  const editor = await getEditorOrNull(path);

  if (editor == null) {
    // Failed to open file.
    return null;
  }

  editor.scrollToBufferPosition([line, 0]);
  editor.setCursorBufferPosition([line, 0]); // Put the focus back in the console prompt.

  atom.commands.dispatch(atom.views.getView(atom.workspace), "atom-ide-console:focus-console-prompt");
  return editor;
}

function firstNonNull(...args) {
  return (0, _nullthrows.default)(args.find(arg => arg != null));
}

function getLineForEvent(editor, event) {
  const cursorLine = editor.getLastCursor().getBufferRow();
  const target = event ? event.target : null;

  if (target == null) {
    return cursorLine;
  } // toggleLine is the line the user clicked in the gutter next to, as opposed
  // to the line the editor's cursor happens to be in. If this command was invoked
  // from the menu, then the cursor position is the target line.


  return firstNonNull(getGutterLineNumber(target), getEditorLineNumber(editor, target), // fall back to the line the cursor is on.
  cursorLine);
}

function isLocalScopeName(scopeName) {
  return ["Local", "Locals"].indexOf(scopeName) !== -1;
}

function evaluateExpressionAsStream(expression, focusedProcess, focusedStackFrame, context) {
  return _rxjsCompatUmdMin.Observable.fromPromise(expression.evaluate(focusedProcess, focusedStackFrame, context)).catch(error => _rxjsCompatUmdMin.Observable.of(_expected.Expect.error(error))).map(() => _expected.Expect.value(expression)).startWith(_expected.Expect.pending());
}

function onUnexpectedError(error) {
  const errorMessage = error.stack || error.message || String(error);

  _logger.default.error("Unexpected error", error);

  atom.notifications.addError("Atom debugger ran into an unexpected error - please file a bug!", {
    detail: errorMessage
  });
}

function capitalize(str) {
  return str[0].toUpperCase() + str.slice(1);
}

function notifyOpenDebugSession() {
  atom.notifications.addInfo("Received a debug request, but there's an open debug session already!", {
    detail: "Please terminate your existing debug session"
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbImdldEd1dHRlckxpbmVOdW1iZXIiLCJ0YXJnZXQiLCJldmVudExpbmUiLCJwYXJzZUludCIsImRhdGFzZXQiLCJsaW5lIiwiaXNOYU4iLCJOdW1iZXIiLCJTQ1JFRU5fUk9XX0FUVFJJQlVURV9OQU1FIiwiZ2V0RWRpdG9yTGluZU51bWJlciIsImVkaXRvciIsIm5vZGUiLCJoYXNBdHRyaWJ1dGUiLCJzY3JlZW5Sb3ciLCJnZXRBdHRyaWJ1dGUiLCJidWZmZXJQb3NpdGlvbkZvclNjcmVlblBvc2l0aW9uIiwicm93IiwiZXJyb3IiLCJwYXJlbnRFbGVtZW50IiwiZ2V0RWRpdG9yT3JOdWxsIiwicGF0aCIsImF0b20iLCJ3b3Jrc3BhY2UiLCJvcGVuIiwic2VhcmNoQWxsUGFuZXMiLCJwZW5kaW5nIiwib3BlblNvdXJjZUxvY2F0aW9uIiwic2Nyb2xsVG9CdWZmZXJQb3NpdGlvbiIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwiY29tbWFuZHMiLCJkaXNwYXRjaCIsInZpZXdzIiwiZ2V0VmlldyIsImZpcnN0Tm9uTnVsbCIsImFyZ3MiLCJmaW5kIiwiYXJnIiwiZ2V0TGluZUZvckV2ZW50IiwiZXZlbnQiLCJjdXJzb3JMaW5lIiwiZ2V0TGFzdEN1cnNvciIsImdldEJ1ZmZlclJvdyIsImlzTG9jYWxTY29wZU5hbWUiLCJzY29wZU5hbWUiLCJpbmRleE9mIiwiZXZhbHVhdGVFeHByZXNzaW9uQXNTdHJlYW0iLCJleHByZXNzaW9uIiwiZm9jdXNlZFByb2Nlc3MiLCJmb2N1c2VkU3RhY2tGcmFtZSIsImNvbnRleHQiLCJPYnNlcnZhYmxlIiwiZnJvbVByb21pc2UiLCJldmFsdWF0ZSIsImNhdGNoIiwib2YiLCJFeHBlY3QiLCJtYXAiLCJ2YWx1ZSIsInN0YXJ0V2l0aCIsIm9uVW5leHBlY3RlZEVycm9yIiwiZXJyb3JNZXNzYWdlIiwic3RhY2siLCJtZXNzYWdlIiwiU3RyaW5nIiwibG9nZ2VyIiwibm90aWZpY2F0aW9ucyIsImFkZEVycm9yIiwiZGV0YWlsIiwiY2FwaXRhbGl6ZSIsInN0ciIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJub3RpZnlPcGVuRGVidWdTZXNzaW9uIiwiYWRkSW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsU0FBU0EsbUJBQVQsQ0FBNkJDLE1BQTdCLEVBQTJEO0FBQ3pELFFBQU1DLFNBQVMsR0FBR0MsUUFBUSxDQUFDRixNQUFNLENBQUNHLE9BQVAsQ0FBZUMsSUFBaEIsRUFBc0IsRUFBdEIsQ0FBMUI7O0FBQ0EsTUFBSUgsU0FBUyxJQUFJLElBQWIsSUFBcUJBLFNBQVMsSUFBSSxDQUFsQyxJQUF1QyxDQUFDSSxLQUFLLENBQUNDLE1BQU0sQ0FBQ0wsU0FBRCxDQUFQLENBQWpELEVBQXNFO0FBQ3BFLFdBQU9BLFNBQVA7QUFDRDtBQUNGOztBQUVELE1BQU1NLHlCQUF5QixHQUFHLGlCQUFsQzs7QUFFQSxTQUFTQyxtQkFBVCxDQUE2QkMsTUFBN0IsRUFBc0RULE1BQXRELEVBQW9GO0FBQ2xGLE1BQUlVLElBQUksR0FBR1YsTUFBWDs7QUFDQSxTQUFPVSxJQUFJLElBQUksSUFBZixFQUFxQjtBQUNuQixRQUFJQSxJQUFJLENBQUNDLFlBQUwsQ0FBa0JKLHlCQUFsQixDQUFKLEVBQWtEO0FBQ2hELFlBQU1LLFNBQVMsR0FBR04sTUFBTSxDQUFDSSxJQUFJLENBQUNHLFlBQUwsQ0FBa0JOLHlCQUFsQixDQUFELENBQXhCOztBQUNBLFVBQUk7QUFDRixlQUFPRSxNQUFNLENBQUNLLCtCQUFQLENBQXVDLENBQUNGLFNBQUQsRUFBWSxDQUFaLENBQXZDLEVBQXVERyxHQUE5RDtBQUNELE9BRkQsQ0FFRSxPQUFPQyxLQUFQLEVBQWM7QUFDZCxlQUFPLElBQVA7QUFDRDtBQUNGOztBQUNETixJQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ08sYUFBWjtBQUNEO0FBQ0Y7O0FBRUQsZUFBZUMsZUFBZixDQUErQkMsSUFBL0IsRUFBd0U7QUFD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QzRDLGFBQUwsQ0FBbUJDLFFBQW5CLENBQTRCLGlFQUE1QixFQUErRjtBQUM3RkMsSUFBQUEsTUFBTSxFQUFFUDtBQURxRixHQUEvRjtBQUdEOztBQUVNLFNBQVNRLFVBQVQsQ0FBb0JDLEdBQXBCLEVBQXlDO0FBQzlDLFNBQU9BLEdBQUcsQ0FBQyxDQUFELENBQUgsQ0FBT0MsV0FBUCxLQUF1QkQsR0FBRyxDQUFDRSxLQUFKLENBQVUsQ0FBVixDQUE5QjtBQUNEOztBQUVNLFNBQVNDLHNCQUFULEdBQXdDO0FBQzdDbkQsRUFBQUEsSUFBSSxDQUFDNEMsYUFBTCxDQUFtQlEsT0FBbkIsQ0FBMkIsc0VBQTNCLEVBQW1HO0FBQ2pHTixJQUFBQSxNQUFNLEVBQUU7QUFEeUYsR0FBbkc7QUFHRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSUV4cHJlc3Npb24sIElFdmFsdWF0YWJsZUV4cHJlc3Npb24sIElQcm9jZXNzLCBJU3RhY2tGcmFtZSwgQ29udGV4dFR5cGUgfSBmcm9tIFwiLi90eXBlc1wiXHJcbmltcG9ydCB0eXBlIHsgRXhwZWN0ZWQgfSBmcm9tIFwiQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvZXhwZWN0ZWRcIlxyXG5cclxuaW1wb3J0IG51bGx0aHJvd3MgZnJvbSBcIm51bGx0aHJvd3NcIlxyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anMtY29tcGF0L2J1bmRsZXMvcnhqcy1jb21wYXQudW1kLm1pbi5qc1wiXHJcbmltcG9ydCBsb2dnZXIgZnJvbSBcIi4vbG9nZ2VyXCJcclxuaW1wb3J0IHsgRXhwZWN0IH0gZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2V4cGVjdGVkXCJcclxuXHJcbmZ1bmN0aW9uIGdldEd1dHRlckxpbmVOdW1iZXIodGFyZ2V0OiBIVE1MRWxlbWVudCk6ID9udW1iZXIge1xyXG4gIGNvbnN0IGV2ZW50TGluZSA9IHBhcnNlSW50KHRhcmdldC5kYXRhc2V0LmxpbmUsIDEwKVxyXG4gIGlmIChldmVudExpbmUgIT0gbnVsbCAmJiBldmVudExpbmUgPj0gMCAmJiAhaXNOYU4oTnVtYmVyKGV2ZW50TGluZSkpKSB7XHJcbiAgICByZXR1cm4gZXZlbnRMaW5lXHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBTQ1JFRU5fUk9XX0FUVFJJQlVURV9OQU1FID0gXCJkYXRhLXNjcmVlbi1yb3dcIlxyXG5cclxuZnVuY3Rpb24gZ2V0RWRpdG9yTGluZU51bWJlcihlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgdGFyZ2V0OiBIVE1MRWxlbWVudCk6ID9udW1iZXIge1xyXG4gIGxldCBub2RlID0gdGFyZ2V0XHJcbiAgd2hpbGUgKG5vZGUgIT0gbnVsbCkge1xyXG4gICAgaWYgKG5vZGUuaGFzQXR0cmlidXRlKFNDUkVFTl9ST1dfQVRUUklCVVRFX05BTUUpKSB7XHJcbiAgICAgIGNvbnN0IHNjcmVlblJvdyA9IE51bWJlcihub2RlLmdldEF0dHJpYnV0ZShTQ1JFRU5fUk9XX0FUVFJJQlVURV9OQU1FKSlcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZXR1cm4gZWRpdG9yLmJ1ZmZlclBvc2l0aW9uRm9yU2NyZWVuUG9zaXRpb24oW3NjcmVlblJvdywgMF0pLnJvd1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBudWxsXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIG5vZGUgPSBub2RlLnBhcmVudEVsZW1lbnRcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEVkaXRvck9yTnVsbChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPD9hdG9tJFRleHRFZGl0b3I+IHtcclxuICB0cnkge1xyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG51Y2xpZGUtaW50ZXJuYWwvYXRvbS1hcGlzXHJcbiAgICByZXR1cm4gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihwYXRoLCB7XHJcbiAgICAgIHNlYXJjaEFsbFBhbmVzOiB0cnVlLFxyXG4gICAgICBwZW5kaW5nOiB0cnVlLFxyXG4gICAgfSlcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBvcGVuU291cmNlTG9jYXRpb24ocGF0aDogc3RyaW5nLCBsaW5lOiBudW1iZXIpOiBQcm9taXNlPD9hdG9tJFRleHRFZGl0b3I+IHtcclxuICBjb25zdCBlZGl0b3IgPSBhd2FpdCBnZXRFZGl0b3JPck51bGwocGF0aClcclxuICBpZiAoZWRpdG9yID09IG51bGwpIHtcclxuICAgIC8vIEZhaWxlZCB0byBvcGVuIGZpbGUuXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuICBlZGl0b3Iuc2Nyb2xsVG9CdWZmZXJQb3NpdGlvbihbbGluZSwgMF0pXHJcbiAgZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKFtsaW5lLCAwXSlcclxuXHJcbiAgLy8gUHV0IHRoZSBmb2N1cyBiYWNrIGluIHRoZSBjb25zb2xlIHByb21wdC5cclxuICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKGF0b20udmlld3MuZ2V0VmlldyhhdG9tLndvcmtzcGFjZSksIFwiYXRvbS1pZGUtY29uc29sZTpmb2N1cy1jb25zb2xlLXByb21wdFwiKVxyXG5cclxuICByZXR1cm4gZWRpdG9yXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpcnN0Tm9uTnVsbCguLi5hcmdzKSB7XHJcbiAgcmV0dXJuIG51bGx0aHJvd3MoYXJncy5maW5kKChhcmcpID0+IGFyZyAhPSBudWxsKSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldExpbmVGb3JFdmVudChlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgZXZlbnQ6IGFueSk6IG51bWJlciB7XHJcbiAgY29uc3QgY3Vyc29yTGluZSA9IGVkaXRvci5nZXRMYXN0Q3Vyc29yKCkuZ2V0QnVmZmVyUm93KClcclxuICBjb25zdCB0YXJnZXQgPSBldmVudCA/IChldmVudC50YXJnZXQ6IEhUTUxFbGVtZW50KSA6IG51bGxcclxuICBpZiAodGFyZ2V0ID09IG51bGwpIHtcclxuICAgIHJldHVybiBjdXJzb3JMaW5lXHJcbiAgfVxyXG4gIC8vIHRvZ2dsZUxpbmUgaXMgdGhlIGxpbmUgdGhlIHVzZXIgY2xpY2tlZCBpbiB0aGUgZ3V0dGVyIG5leHQgdG8sIGFzIG9wcG9zZWRcclxuICAvLyB0byB0aGUgbGluZSB0aGUgZWRpdG9yJ3MgY3Vyc29yIGhhcHBlbnMgdG8gYmUgaW4uIElmIHRoaXMgY29tbWFuZCB3YXMgaW52b2tlZFxyXG4gIC8vIGZyb20gdGhlIG1lbnUsIHRoZW4gdGhlIGN1cnNvciBwb3NpdGlvbiBpcyB0aGUgdGFyZ2V0IGxpbmUuXHJcbiAgcmV0dXJuIGZpcnN0Tm9uTnVsbChcclxuICAgIGdldEd1dHRlckxpbmVOdW1iZXIodGFyZ2V0KSxcclxuICAgIGdldEVkaXRvckxpbmVOdW1iZXIoZWRpdG9yLCB0YXJnZXQpLFxyXG4gICAgLy8gZmFsbCBiYWNrIHRvIHRoZSBsaW5lIHRoZSBjdXJzb3IgaXMgb24uXHJcbiAgICBjdXJzb3JMaW5lXHJcbiAgKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNMb2NhbFNjb3BlTmFtZShzY29wZU5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gIHJldHVybiBbXCJMb2NhbFwiLCBcIkxvY2Fsc1wiXS5pbmRleE9mKHNjb3BlTmFtZSkgIT09IC0xXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBldmFsdWF0ZUV4cHJlc3Npb25Bc1N0cmVhbShcclxuICBleHByZXNzaW9uOiBJRXZhbHVhdGFibGVFeHByZXNzaW9uLFxyXG4gIGZvY3VzZWRQcm9jZXNzOiBJUHJvY2VzcyxcclxuICBmb2N1c2VkU3RhY2tGcmFtZTogP0lTdGFja0ZyYW1lLFxyXG4gIGNvbnRleHQ6IENvbnRleHRUeXBlXHJcbik6IE9ic2VydmFibGU8RXhwZWN0ZWQ8SUV4cHJlc3Npb24+PiB7XHJcbiAgcmV0dXJuIE9ic2VydmFibGUuZnJvbVByb21pc2UoZXhwcmVzc2lvbi5ldmFsdWF0ZShmb2N1c2VkUHJvY2VzcywgZm9jdXNlZFN0YWNrRnJhbWUsIGNvbnRleHQpKVxyXG4gICAgLmNhdGNoKChlcnJvcikgPT4gT2JzZXJ2YWJsZS5vZihFeHBlY3QuZXJyb3IoZXJyb3IpKSlcclxuICAgIC5tYXAoKCkgPT4gRXhwZWN0LnZhbHVlKGV4cHJlc3Npb24pKVxyXG4gICAgLnN0YXJ0V2l0aChFeHBlY3QucGVuZGluZygpKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb25VbmV4cGVjdGVkRXJyb3IoZXJyb3I6IGFueSkge1xyXG4gIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yLnN0YWNrIHx8IGVycm9yLm1lc3NhZ2UgfHwgU3RyaW5nKGVycm9yKVxyXG4gIGxvZ2dlci5lcnJvcihcIlVuZXhwZWN0ZWQgZXJyb3JcIiwgZXJyb3IpXHJcbiAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFwiQXRvbSBkZWJ1Z2dlciByYW4gaW50byBhbiB1bmV4cGVjdGVkIGVycm9yIC0gcGxlYXNlIGZpbGUgYSBidWchXCIsIHtcclxuICAgIGRldGFpbDogZXJyb3JNZXNzYWdlLFxyXG4gIH0pXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYXBpdGFsaXplKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcclxuICByZXR1cm4gc3RyWzBdLnRvVXBwZXJDYXNlKCkgKyBzdHIuc2xpY2UoMSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG5vdGlmeU9wZW5EZWJ1Z1Nlc3Npb24oKTogdm9pZCB7XHJcbiAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEluZm8oXCJSZWNlaXZlZCBhIGRlYnVnIHJlcXVlc3QsIGJ1dCB0aGVyZSdzIGFuIG9wZW4gZGVidWcgc2Vzc2lvbiBhbHJlYWR5IVwiLCB7XHJcbiAgICBkZXRhaWw6IFwiUGxlYXNlIHRlcm1pbmF0ZSB5b3VyIGV4aXN0aW5nIGRlYnVnIHNlc3Npb25cIixcclxuICB9KVxyXG59XHJcbiJdfQ==