"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.openSourceLocation = openSourceLocation;
exports.getLineForEvent = getLineForEvent;
exports.isLocalScopeName = isLocalScopeName;
exports.evaluateExpressionAsStream = evaluateExpressionAsStream;
exports.onUnexpectedError = onUnexpectedError;
exports.capitalize = capitalize;
exports.notifyOpenDebugSession = notifyOpenDebugSession;

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _rxjs = require("rxjs");

var _logger = _interopRequireDefault(require("./logger"));

var _expected = require("@atom-ide-community/nuclide-commons/expected");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getGutterLineNumber(target) {
  const eventLine = parseInt(target.dataset.line, 10);

  if (eventLine != null && eventLine >= 0 && !isNaN(Number(eventLine))) {
    return eventLine;
  }
}

const SCREEN_ROW_ATTRIBUTE_NAME = "data-screen-row";

function getEditorLineNumber(editor, target) {
  let node = target;

  while (node != null) {
    if (node.hasAttribute(SCREEN_ROW_ATTRIBUTE_NAME)) {
      const screenRow = Number(node.getAttribute(SCREEN_ROW_ATTRIBUTE_NAME));

      try {
        return editor.bufferPositionForScreenPosition([screenRow, 0]).row;
      } catch (error) {
        return null;
      }
    }

    node = node.parentElement;
  }
}

async function getEditorOrNull(path) {
  try {
    // eslint-disable-next-line nuclide-internal/atom-apis
    return await atom.workspace.open(path, {
      searchAllPanes: true,
      pending: true
    });
  } catch (error) {
    return null;
  }
}

async function openSourceLocation(path, line) {
  const editor = await getEditorOrNull(path);

  if (editor == null) {
    // Failed to open file.
    return null;
  }

  editor.scrollToBufferPosition([line, 0]);
  editor.setCursorBufferPosition([line, 0]); // Put the focus back in the console prompt.

  atom.commands.dispatch(atom.views.getView(atom.workspace), "atom-ide-console:focus-console-prompt");
  return editor;
}

function firstNonNull(...args) {
  return (0, _nullthrows.default)(args.find(arg => arg != null));
}

function getLineForEvent(editor, event) {
  const cursorLine = editor.getLastCursor().getBufferRow();
  const target = event ? event.target : null;

  if (target == null) {
    return cursorLine;
  } // toggleLine is the line the user clicked in the gutter next to, as opposed
  // to the line the editor's cursor happens to be in. If this command was invoked
  // from the menu, then the cursor position is the target line.


  return firstNonNull(getGutterLineNumber(target), getEditorLineNumber(editor, target), // fall back to the line the cursor is on.
  cursorLine);
}

function isLocalScopeName(scopeName) {
  return ["Local", "Locals"].indexOf(scopeName) !== -1;
}

function evaluateExpressionAsStream(expression, focusedProcess, focusedStackFrame, context) {
  return _rxjs.Observable.fromPromise(expression.evaluate(focusedProcess, focusedStackFrame, context)).catch(error => _rxjs.Observable.of(_expected.Expect.error(error))).map(() => _expected.Expect.value(expression)).startWith(_expected.Expect.pending());
}

function onUnexpectedError(error) {
  const errorMessage = error.stack || error.message || String(error);

  _logger.default.error("Unexpected error", error);

  atom.notifications.addError("Atom debugger ran into an unexpected error - please file a bug!", {
    detail: errorMessage
  });
}

function capitalize(str) {
  return str[0].toUpperCase() + str.slice(1);
}

function notifyOpenDebugSession() {
  atom.notifications.addInfo("Received a debug request, but there's an open debug session already!", {
    detail: "Please terminate your existing debug session"
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbImdldEd1dHRlckxpbmVOdW1iZXIiLCJ0YXJnZXQiLCJldmVudExpbmUiLCJwYXJzZUludCIsImRhdGFzZXQiLCJsaW5lIiwiaXNOYU4iLCJOdW1iZXIiLCJTQ1JFRU5fUk9XX0FUVFJJQlVURV9OQU1FIiwiZ2V0RWRpdG9yTGluZU51bWJlciIsImVkaXRvciIsIm5vZGUiLCJoYXNBdHRyaWJ1dGUiLCJzY3JlZW5Sb3ciLCJnZXRBdHRyaWJ1dGUiLCJidWZmZXJQb3NpdGlvbkZvclNjcmVlblBvc2l0aW9uIiwicm93IiwiZXJyb3IiLCJwYXJlbnRFbGVtZW50IiwiZ2V0RWRpdG9yT3JOdWxsIiwicGF0aCIsImF0b20iLCJ3b3Jrc3BhY2UiLCJvcGVuIiwic2VhcmNoQWxsUGFuZXMiLCJwZW5kaW5nIiwib3BlblNvdXJjZUxvY2F0aW9uIiwic2Nyb2xsVG9CdWZmZXJQb3NpdGlvbiIsInNldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwiY29tbWFuZHMiLCJkaXNwYXRjaCIsInZpZXdzIiwiZ2V0VmlldyIsImZpcnN0Tm9uTnVsbCIsImFyZ3MiLCJmaW5kIiwiYXJnIiwiZ2V0TGluZUZvckV2ZW50IiwiZXZlbnQiLCJjdXJzb3JMaW5lIiwiZ2V0TGFzdEN1cnNvciIsImdldEJ1ZmZlclJvdyIsImlzTG9jYWxTY29wZU5hbWUiLCJzY29wZU5hbWUiLCJpbmRleE9mIiwiZXZhbHVhdGVFeHByZXNzaW9uQXNTdHJlYW0iLCJleHByZXNzaW9uIiwiZm9jdXNlZFByb2Nlc3MiLCJmb2N1c2VkU3RhY2tGcmFtZSIsImNvbnRleHQiLCJPYnNlcnZhYmxlIiwiZnJvbVByb21pc2UiLCJldmFsdWF0ZSIsImNhdGNoIiwib2YiLCJFeHBlY3QiLCJtYXAiLCJ2YWx1ZSIsInN0YXJ0V2l0aCIsIm9uVW5leHBlY3RlZEVycm9yIiwiZXJyb3JNZXNzYWdlIiwic3RhY2siLCJtZXNzYWdlIiwiU3RyaW5nIiwibG9nZ2VyIiwibm90aWZpY2F0aW9ucyIsImFkZEVycm9yIiwiZGV0YWlsIiwiY2FwaXRhbGl6ZSIsInN0ciIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJub3RpZnlPcGVuRGVidWdTZXNzaW9uIiwiYWRkSW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUdBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsU0FBU0EsbUJBQVQsQ0FBNkJDLE1BQTdCLEVBQTJEO0FBQ3pELFFBQU1DLFNBQVMsR0FBR0MsUUFBUSxDQUFDRixNQUFNLENBQUNHLE9BQVAsQ0FBZUMsSUFBaEIsRUFBc0IsRUFBdEIsQ0FBMUI7O0FBQ0EsTUFBSUgsU0FBUyxJQUFJLElBQWIsSUFBcUJBLFNBQVMsSUFBSSxDQUFsQyxJQUF1QyxDQUFDSSxLQUFLLENBQUNDLE1BQU0sQ0FBQ0wsU0FBRCxDQUFQLENBQWpELEVBQXNFO0FBQ3BFLFdBQU9BLFNBQVA7QUFDRDtBQUNGOztBQUVELE1BQU1NLHlCQUF5QixHQUFHLGlCQUFsQzs7QUFFQSxTQUFTQyxtQkFBVCxDQUE2QkMsTUFBN0IsRUFBc0RULE1BQXRELEVBQW9GO0FBQ2xGLE1BQUlVLElBQUksR0FBR1YsTUFBWDs7QUFDQSxTQUFPVSxJQUFJLElBQUksSUFBZixFQUFxQjtBQUNuQixRQUFJQSxJQUFJLENBQUNDLFlBQUwsQ0FBa0JKLHlCQUFsQixDQUFKLEVBQWtEO0FBQ2hELFlBQU1LLFNBQVMsR0FBR04sTUFBTSxDQUFDSSxJQUFJLENBQUNHLFlBQUwsQ0FBa0JOLHlCQUFsQixDQUFELENBQXhCOztBQUNBLFVBQUk7QUFDRixlQUFPRSxNQUFNLENBQUNLLCtCQUFQLENBQXVDLENBQUNGLFNBQUQsRUFBWSxDQUFaLENBQXZDLEVBQXVERyxHQUE5RDtBQUNELE9BRkQsQ0FFRSxPQUFPQyxLQUFQLEVBQWM7QUFDZCxlQUFPLElBQVA7QUFDRDtBQUNGOztBQUNETixJQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ08sYUFBWjtBQUNEO0FBQ0Y7O0FBRUQsZUFBZUMsZUFBZixDQUErQkMsSUFBL0IsRUFBd0U7QUFD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QzRDLGFBQUwsQ0FBbUJDLFFBQW5CLENBQTRCLGlFQUE1QixFQUErRjtBQUM3RkMsSUFBQUEsTUFBTSxFQUFFUDtBQURxRixHQUEvRjtBQUdEOztBQUVNLFNBQVNRLFVBQVQsQ0FBb0JDLEdBQXBCLEVBQXlDO0FBQzlDLFNBQU9BLEdBQUcsQ0FBQyxDQUFELENBQUgsQ0FBT0MsV0FBUCxLQUF1QkQsR0FBRyxDQUFDRSxLQUFKLENBQVUsQ0FBVixDQUE5QjtBQUNEOztBQUVNLFNBQVNDLHNCQUFULEdBQXdDO0FBQzdDbkQsRUFBQUEsSUFBSSxDQUFDNEMsYUFBTCxDQUFtQlEsT0FBbkIsQ0FBMkIsc0VBQTNCLEVBQW1HO0FBQ2pHTixJQUFBQSxNQUFNLEVBQUU7QUFEeUYsR0FBbkc7QUFHRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSUV4cHJlc3Npb24sIElFdmFsdWF0YWJsZUV4cHJlc3Npb24sIElQcm9jZXNzLCBJU3RhY2tGcmFtZSwgQ29udGV4dFR5cGUgfSBmcm9tIFwiLi90eXBlc1wiXG5pbXBvcnQgdHlwZSB7IEV4cGVjdGVkIH0gZnJvbSBcIkBhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2V4cGVjdGVkXCJcblxuaW1wb3J0IG51bGx0aHJvd3MgZnJvbSBcIm51bGx0aHJvd3NcIlxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCJcbmltcG9ydCBsb2dnZXIgZnJvbSBcIi4vbG9nZ2VyXCJcbmltcG9ydCB7IEV4cGVjdCB9IGZyb20gXCJAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9leHBlY3RlZFwiXG5cbmZ1bmN0aW9uIGdldEd1dHRlckxpbmVOdW1iZXIodGFyZ2V0OiBIVE1MRWxlbWVudCk6ID9udW1iZXIge1xuICBjb25zdCBldmVudExpbmUgPSBwYXJzZUludCh0YXJnZXQuZGF0YXNldC5saW5lLCAxMClcbiAgaWYgKGV2ZW50TGluZSAhPSBudWxsICYmIGV2ZW50TGluZSA+PSAwICYmICFpc05hTihOdW1iZXIoZXZlbnRMaW5lKSkpIHtcbiAgICByZXR1cm4gZXZlbnRMaW5lXG4gIH1cbn1cblxuY29uc3QgU0NSRUVOX1JPV19BVFRSSUJVVEVfTkFNRSA9IFwiZGF0YS1zY3JlZW4tcm93XCJcblxuZnVuY3Rpb24gZ2V0RWRpdG9yTGluZU51bWJlcihlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgdGFyZ2V0OiBIVE1MRWxlbWVudCk6ID9udW1iZXIge1xuICBsZXQgbm9kZSA9IHRhcmdldFxuICB3aGlsZSAobm9kZSAhPSBudWxsKSB7XG4gICAgaWYgKG5vZGUuaGFzQXR0cmlidXRlKFNDUkVFTl9ST1dfQVRUUklCVVRFX05BTUUpKSB7XG4gICAgICBjb25zdCBzY3JlZW5Sb3cgPSBOdW1iZXIobm9kZS5nZXRBdHRyaWJ1dGUoU0NSRUVOX1JPV19BVFRSSUJVVEVfTkFNRSkpXG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmJ1ZmZlclBvc2l0aW9uRm9yU2NyZWVuUG9zaXRpb24oW3NjcmVlblJvdywgMF0pLnJvd1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cbiAgICB9XG4gICAgbm9kZSA9IG5vZGUucGFyZW50RWxlbWVudFxuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEVkaXRvck9yTnVsbChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPD9hdG9tJFRleHRFZGl0b3I+IHtcbiAgdHJ5IHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbnVjbGlkZS1pbnRlcm5hbC9hdG9tLWFwaXNcbiAgICByZXR1cm4gYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3BlbihwYXRoLCB7XG4gICAgICBzZWFyY2hBbGxQYW5lczogdHJ1ZSxcbiAgICAgIHBlbmRpbmc6IHRydWUsXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBvcGVuU291cmNlTG9jYXRpb24ocGF0aDogc3RyaW5nLCBsaW5lOiBudW1iZXIpOiBQcm9taXNlPD9hdG9tJFRleHRFZGl0b3I+IHtcbiAgY29uc3QgZWRpdG9yID0gYXdhaXQgZ2V0RWRpdG9yT3JOdWxsKHBhdGgpXG4gIGlmIChlZGl0b3IgPT0gbnVsbCkge1xuICAgIC8vIEZhaWxlZCB0byBvcGVuIGZpbGUuXG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICBlZGl0b3Iuc2Nyb2xsVG9CdWZmZXJQb3NpdGlvbihbbGluZSwgMF0pXG4gIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbbGluZSwgMF0pXG5cbiAgLy8gUHV0IHRoZSBmb2N1cyBiYWNrIGluIHRoZSBjb25zb2xlIHByb21wdC5cbiAgYXRvbS5jb21tYW5kcy5kaXNwYXRjaChhdG9tLnZpZXdzLmdldFZpZXcoYXRvbS53b3Jrc3BhY2UpLCBcImF0b20taWRlLWNvbnNvbGU6Zm9jdXMtY29uc29sZS1wcm9tcHRcIilcblxuICByZXR1cm4gZWRpdG9yXG59XG5cbmZ1bmN0aW9uIGZpcnN0Tm9uTnVsbCguLi5hcmdzKSB7XG4gIHJldHVybiBudWxsdGhyb3dzKGFyZ3MuZmluZCgoYXJnKSA9PiBhcmcgIT0gbnVsbCkpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRMaW5lRm9yRXZlbnQoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIGV2ZW50OiBhbnkpOiBudW1iZXIge1xuICBjb25zdCBjdXJzb3JMaW5lID0gZWRpdG9yLmdldExhc3RDdXJzb3IoKS5nZXRCdWZmZXJSb3coKVxuICBjb25zdCB0YXJnZXQgPSBldmVudCA/IChldmVudC50YXJnZXQ6IEhUTUxFbGVtZW50KSA6IG51bGxcbiAgaWYgKHRhcmdldCA9PSBudWxsKSB7XG4gICAgcmV0dXJuIGN1cnNvckxpbmVcbiAgfVxuICAvLyB0b2dnbGVMaW5lIGlzIHRoZSBsaW5lIHRoZSB1c2VyIGNsaWNrZWQgaW4gdGhlIGd1dHRlciBuZXh0IHRvLCBhcyBvcHBvc2VkXG4gIC8vIHRvIHRoZSBsaW5lIHRoZSBlZGl0b3IncyBjdXJzb3IgaGFwcGVucyB0byBiZSBpbi4gSWYgdGhpcyBjb21tYW5kIHdhcyBpbnZva2VkXG4gIC8vIGZyb20gdGhlIG1lbnUsIHRoZW4gdGhlIGN1cnNvciBwb3NpdGlvbiBpcyB0aGUgdGFyZ2V0IGxpbmUuXG4gIHJldHVybiBmaXJzdE5vbk51bGwoXG4gICAgZ2V0R3V0dGVyTGluZU51bWJlcih0YXJnZXQpLFxuICAgIGdldEVkaXRvckxpbmVOdW1iZXIoZWRpdG9yLCB0YXJnZXQpLFxuICAgIC8vIGZhbGwgYmFjayB0byB0aGUgbGluZSB0aGUgY3Vyc29yIGlzIG9uLlxuICAgIGN1cnNvckxpbmVcbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNMb2NhbFNjb3BlTmFtZShzY29wZU5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gW1wiTG9jYWxcIiwgXCJMb2NhbHNcIl0uaW5kZXhPZihzY29wZU5hbWUpICE9PSAtMVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZXZhbHVhdGVFeHByZXNzaW9uQXNTdHJlYW0oXG4gIGV4cHJlc3Npb246IElFdmFsdWF0YWJsZUV4cHJlc3Npb24sXG4gIGZvY3VzZWRQcm9jZXNzOiBJUHJvY2VzcyxcbiAgZm9jdXNlZFN0YWNrRnJhbWU6ID9JU3RhY2tGcmFtZSxcbiAgY29udGV4dDogQ29udGV4dFR5cGVcbik6IE9ic2VydmFibGU8RXhwZWN0ZWQ8SUV4cHJlc3Npb24+PiB7XG4gIHJldHVybiBPYnNlcnZhYmxlLmZyb21Qcm9taXNlKGV4cHJlc3Npb24uZXZhbHVhdGUoZm9jdXNlZFByb2Nlc3MsIGZvY3VzZWRTdGFja0ZyYW1lLCBjb250ZXh0KSlcbiAgICAuY2F0Y2goKGVycm9yKSA9PiBPYnNlcnZhYmxlLm9mKEV4cGVjdC5lcnJvcihlcnJvcikpKVxuICAgIC5tYXAoKCkgPT4gRXhwZWN0LnZhbHVlKGV4cHJlc3Npb24pKVxuICAgIC5zdGFydFdpdGgoRXhwZWN0LnBlbmRpbmcoKSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uVW5leHBlY3RlZEVycm9yKGVycm9yOiBhbnkpIHtcbiAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3Iuc3RhY2sgfHwgZXJyb3IubWVzc2FnZSB8fCBTdHJpbmcoZXJyb3IpXG4gIGxvZ2dlci5lcnJvcihcIlVuZXhwZWN0ZWQgZXJyb3JcIiwgZXJyb3IpXG4gIGF0b20ubm90aWZpY2F0aW9ucy5hZGRFcnJvcihcIkF0b20gZGVidWdnZXIgcmFuIGludG8gYW4gdW5leHBlY3RlZCBlcnJvciAtIHBsZWFzZSBmaWxlIGEgYnVnIVwiLCB7XG4gICAgZGV0YWlsOiBlcnJvck1lc3NhZ2UsXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYXBpdGFsaXplKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHN0clswXS50b1VwcGVyQ2FzZSgpICsgc3RyLnNsaWNlKDEpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3RpZnlPcGVuRGVidWdTZXNzaW9uKCk6IHZvaWQge1xuICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkSW5mbyhcIlJlY2VpdmVkIGEgZGVidWcgcmVxdWVzdCwgYnV0IHRoZXJlJ3MgYW4gb3BlbiBkZWJ1ZyBzZXNzaW9uIGFscmVhZHkhXCIsIHtcbiAgICBkZXRhaWw6IFwiUGxlYXNlIHRlcm1pbmF0ZSB5b3VyIGV4aXN0aW5nIGRlYnVnIHNlc3Npb25cIixcbiAgfSlcbn1cbiJdfQ==